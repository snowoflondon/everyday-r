<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Everyday data wrangling | Everyday-R: Practical R for Data Science</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.32.1 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Everyday data wrangling | Everyday-R: Practical R for Data Science" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Everyday data wrangling | Everyday-R: Practical R for Data Science" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="by Brian Jungmin Park" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="everyday-iterations.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Everyday-R by snowoflondon</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#r-syntax-in-this-book"><i class="fa fa-check"></i><b>1.1</b> R syntax in this book</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#r-packages-commonly-used-in-this-book"><i class="fa fa-check"></i><b>1.2</b> R packages commonly used in this book</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#installing-r-packages"><i class="fa fa-check"></i><b>1.3</b> Installing R packages</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#code-availability"><i class="fa fa-check"></i><b>1.4</b> Code availability</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#website-hosting"><i class="fa fa-check"></i><b>1.5</b> Website hosting</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html"><i class="fa fa-check"></i><b>2</b> Everyday data wrangling</a>
<ul>
<li class="chapter" data-level="2.1" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#renaming-column-headers"><i class="fa fa-check"></i><b>2.1</b> Renaming column headers</a></li>
<li class="chapter" data-level="2.2" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#grouped-operations"><i class="fa fa-check"></i><b>2.2</b> Grouped operations</a></li>
<li class="chapter" data-level="2.3" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#data-transformation"><i class="fa fa-check"></i><b>2.3</b> Data transformation</a></li>
<li class="chapter" data-level="2.4" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#joining-and-separating-character-columns"><i class="fa fa-check"></i><b>2.4</b> Joining and separating character columns</a></li>
<li class="chapter" data-level="2.5" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#filtering-rows"><i class="fa fa-check"></i><b>2.5</b> Filtering rows</a></li>
<li class="chapter" data-level="2.6" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#subsetting-columns-based-on-strings"><i class="fa fa-check"></i><b>2.6</b> Subsetting columns based on strings</a></li>
<li class="chapter" data-level="2.7" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#long-and-wide-data-formats"><i class="fa fa-check"></i><b>2.7</b> Long and wide data formats</a></li>
<li class="chapter" data-level="2.8" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#trimming-strings"><i class="fa fa-check"></i><b>2.8</b> Trimming strings</a></li>
<li class="chapter" data-level="2.9" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#iterating-over-list-of-dataframes"><i class="fa fa-check"></i><b>2.9</b> Iterating over list of dataframes</a></li>
<li class="chapter" data-level="2.10" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#rowwise-operations"><i class="fa fa-check"></i><b>2.10</b> Rowwise operations</a></li>
<li class="chapter" data-level="2.11" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#conditional-transformation"><i class="fa fa-check"></i><b>2.11</b> Conditional transformation</a></li>
<li class="chapter" data-level="2.12" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#missing-values"><i class="fa fa-check"></i><b>2.12</b> Missing values</a></li>
<li class="chapter" data-level="2.13" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#joining-dataframes"><i class="fa fa-check"></i><b>2.13</b> Joining dataframes</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="everyday-iterations.html"><a href="everyday-iterations.html"><i class="fa fa-check"></i><b>3</b> Everyday iterations</a>
<ul>
<li class="chapter" data-level="3.1" data-path="everyday-iterations.html"><a href="everyday-iterations.html#iterating-over-multiple-columns-using-apply-dplyr-and-purrr"><i class="fa fa-check"></i><b>3.1</b> Iterating over multiple columns using <code>apply</code>, <code>dplyr</code>, and <code>purrr</code></a></li>
<li class="chapter" data-level="3.2" data-path="everyday-iterations.html"><a href="everyday-iterations.html#iterating-over-lists"><i class="fa fa-check"></i><b>3.2</b> Iterating over lists</a></li>
<li class="chapter" data-level="3.3" data-path="everyday-iterations.html"><a href="everyday-iterations.html#iterating-over-vectors"><i class="fa fa-check"></i><b>3.3</b> Iterating over vectors</a></li>
<li class="chapter" data-level="3.4" data-path="everyday-iterations.html"><a href="everyday-iterations.html#iterating-with-two-inputs"><i class="fa fa-check"></i><b>3.4</b> Iterating with two inputs</a></li>
<li class="chapter" data-level="3.5" data-path="everyday-iterations.html"><a href="everyday-iterations.html#iterating-over-indices-and-names"><i class="fa fa-check"></i><b>3.5</b> Iterating over indices and names</a></li>
<li class="chapter" data-level="3.6" data-path="everyday-iterations.html"><a href="everyday-iterations.html#handling-errors-within-purrr"><i class="fa fa-check"></i><b>3.6</b> Handling errors within <code>purrr</code></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="interlude-i-a-brief-glimpse-into-data.html"><a href="interlude-i-a-brief-glimpse-into-data.html"><i class="fa fa-check"></i><b>4</b> Interlude I: A brief glimpse into <code>data.table</code></a>
<ul>
<li class="chapter" data-level="4.1" data-path="interlude-i-a-brief-glimpse-into-data.html"><a href="interlude-i-a-brief-glimpse-into-data.html#data-wrangling-operations"><i class="fa fa-check"></i><b>4.1</b> Data wrangling operations</a></li>
<li class="chapter" data-level="4.2" data-path="interlude-i-a-brief-glimpse-into-data.html"><a href="interlude-i-a-brief-glimpse-into-data.html#sd-.sdcols-and"><i class="fa fa-check"></i><b>4.2</b> <code>.SD</code>, <code>.SDcols</code>, and <code>:=</code></a></li>
<li class="chapter" data-level="4.3" data-path="interlude-i-a-brief-glimpse-into-data.html"><a href="interlude-i-a-brief-glimpse-into-data.html#reshaping-data-using-melt-and-dcast"><i class="fa fa-check"></i><b>4.3</b> Reshaping data using <code>melt</code> and <code>dcast</code></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="everyday-exploratory-data-analysis.html"><a href="everyday-exploratory-data-analysis.html"><i class="fa fa-check"></i><b>5</b> Everyday exploratory data analysis</a>
<ul>
<li class="chapter" data-level="5.1" data-path="everyday-exploratory-data-analysis.html"><a href="everyday-exploratory-data-analysis.html#workflow-1-continuous-data"><i class="fa fa-check"></i><b>5.1</b> Workflow 1: continuous data</a></li>
<li class="chapter" data-level="5.2" data-path="everyday-exploratory-data-analysis.html"><a href="everyday-exploratory-data-analysis.html#workflow-2-dates-and-ordinal-data"><i class="fa fa-check"></i><b>5.2</b> Workflow 2: dates and ordinal data</a></li>
<li class="chapter" data-level="5.3" data-path="everyday-exploratory-data-analysis.html"><a href="everyday-exploratory-data-analysis.html#visualization-of-clusters"><i class="fa fa-check"></i><b>5.3</b> Visualization of clusters</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="everyday-ml-classification.html"><a href="everyday-ml-classification.html"><i class="fa fa-check"></i><b>6</b> Everyday ML: Classification</a>
<ul>
<li class="chapter" data-level="6.1" data-path="everyday-ml-classification.html"><a href="everyday-ml-classification.html#model-training-and-predictions"><i class="fa fa-check"></i><b>6.1</b> Model training and predictions</a></li>
<li class="chapter" data-level="6.2" data-path="everyday-ml-classification.html"><a href="everyday-ml-classification.html#feature-selection-using-univariate-filters"><i class="fa fa-check"></i><b>6.2</b> Feature selection using univariate filters</a></li>
<li class="chapter" data-level="6.3" data-path="everyday-ml-classification.html"><a href="everyday-ml-classification.html#feature-selection-using-recursive-feature-elimination"><i class="fa fa-check"></i><b>6.3</b> Feature selection using recursive feature elimination</a></li>
<li class="chapter" data-level="6.4" data-path="everyday-ml-classification.html"><a href="everyday-ml-classification.html#hyperparameter-tuning"><i class="fa fa-check"></i><b>6.4</b> Hyperparameter tuning</a></li>
<li class="chapter" data-level="6.5" data-path="everyday-ml-classification.html"><a href="everyday-ml-classification.html#roc-and-precision-recall-curves"><i class="fa fa-check"></i><b>6.5</b> ROC and precision-recall curves</a></li>
<li class="chapter" data-level="6.6" data-path="everyday-ml-classification.html"><a href="everyday-ml-classification.html#model-comparisons"><i class="fa fa-check"></i><b>6.6</b> Model comparisons</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Everyday-R: Practical R for Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="everyday-data-wrangling" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Everyday data wrangling<a href="everyday-data-wrangling.html#everyday-data-wrangling" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Suppose there exists a test dataset and the user is tasked with proving their proficiency in exploratory data analysis (EDA). Alternatively, the user may be handed a piece of data (e.g., maybe an Excel sheet) and is asked to run some preliminary analysis. Prior to jumping straight into EDA and statistical modeling, the user must be able to transform the original data into a desirable format. This includes, but is not limited to, missing data imputation, scalar transformation, feature selection, group aggregation, and data filtering. The following notebook outlines the fundamentals of data wrangling, using practical base R and <code>tidyverse</code> solutions interchangeably.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="everyday-data-wrangling.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<pre><code>## ── Attaching packages ───────── tidyverse 1.3.1 ──</code></pre>
<pre><code>## ✔ ggplot2 3.4.1     ✔ purrr   1.0.1
## ✔ tibble  3.2.0     ✔ dplyr   1.1.0
## ✔ tidyr   1.3.0     ✔ stringr 1.5.0
## ✔ readr   1.4.0     ✔ forcats 0.5.1</code></pre>
<pre><code>## ── Conflicts ──────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<div id="renaming-column-headers" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Renaming column headers<a href="everyday-data-wrangling.html#renaming-column-headers" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Suppose a <code>32 x 11</code> dataset <code>mtcars</code> where <code>rownames</code> correspond to the car model.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="everyday-data-wrangling.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mtcars)</span>
<span id="cb11-2"><a href="everyday-data-wrangling.html#cb11-2" aria-hidden="true" tabindex="-1"></a>mtcars <span class="ot">&lt;-</span> mtcars <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">&#39;CAR&#39;</span>)</span></code></pre></div>
<p>Renaming column headers with <code>dplyr::rename</code> is as simple as <code>rename(new_name = old_name)</code>, but with <code>rename_with()</code> there’s more flexibility:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="everyday-data-wrangling.html#cb12-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">rename_with</span>(toupper)</span></code></pre></div>
<pre><code>## # A tibble: 32 × 12
##    CAR     MPG   CYL  DISP    HP  DRAT    WT  QSEC
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Mazd…  21       6  160    110  3.9   2.62  16.5
##  2 Mazd…  21       6  160    110  3.9   2.88  17.0
##  3 Dats…  22.8     4  108     93  3.85  2.32  18.6
##  4 Horn…  21.4     6  258    110  3.08  3.22  19.4
##  5 Horn…  18.7     8  360    175  3.15  3.44  17.0
##  6 Vali…  18.1     6  225    105  2.76  3.46  20.2
##  7 Dust…  14.3     8  360    245  3.21  3.57  15.8
##  8 Merc…  24.4     4  147.    62  3.69  3.19  20  
##  9 Merc…  22.8     4  141.    95  3.92  3.15  22.9
## 10 Merc…  19.2     6  168.   123  3.92  3.44  18.3
## # … with 22 more rows, and 4 more variables:
## #   VS &lt;dbl&gt;, AM &lt;dbl&gt;, GEAR &lt;dbl&gt;, CARB &lt;dbl&gt;</code></pre>
<p>You can pass any function within <code>rename_with()</code> to alter the column headers and use the <code>.cols =</code> argument to define which columns you’d apply the function to:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="everyday-data-wrangling.html#cb14-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">rename_with</span>(<span class="cf">function</span>(x) <span class="fu">paste0</span>(x, <span class="st">&quot;_1&quot;</span>), <span class="at">.cols =</span> <span class="sc">-</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 32 × 12
##    CAR       mpg_1 cyl_1 disp_1  hp_1 drat_1  wt_1
##    &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1 Mazda RX4  21       6   160    110   3.9   2.62
##  2 Mazda RX…  21       6   160    110   3.9   2.88
##  3 Datsun 7…  22.8     4   108     93   3.85  2.32
##  4 Hornet 4…  21.4     6   258    110   3.08  3.22
##  5 Hornet S…  18.7     8   360    175   3.15  3.44
##  6 Valiant    18.1     6   225    105   2.76  3.46
##  7 Duster 3…  14.3     8   360    245   3.21  3.57
##  8 Merc 240D  24.4     4   147.    62   3.69  3.19
##  9 Merc 230   22.8     4   141.    95   3.92  3.15
## 10 Merc 280   19.2     6   168.   123   3.92  3.44
## # … with 22 more rows, and 5 more variables:
## #   qsec_1 &lt;dbl&gt;, vs_1 &lt;dbl&gt;, am_1 &lt;dbl&gt;,
## #   gear_1 &lt;dbl&gt;, carb_1 &lt;dbl&gt;</code></pre>
<p>Alternatively with base R, you can call the <code>names</code> attribute and alter that directly:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="everyday-data-wrangling.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mtcars)[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">names</span>(mtcars[<span class="sc">-</span><span class="dv">1</span>]), <span class="st">&#39;_1&#39;</span>) <span class="co"># not run</span></span></code></pre></div>
</div>
<div id="grouped-operations" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Grouped operations<a href="everyday-data-wrangling.html#grouped-operations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Grouped operations are most useful when you’re working with data where there is a categorical variable. Grouped summaries are powerful tools easily done with <code>dplyr::summarise</code>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="everyday-data-wrangling.html#cb17-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">avg_mpg =</span> <span class="fu">mean</span>(mpg))</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##     cyl avg_mpg
##   &lt;dbl&gt;   &lt;dbl&gt;
## 1     4    26.7
## 2     6    19.7
## 3     8    15.1</code></pre>
<p>Using multiple columns at once and renaming the output columns:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="everyday-data-wrangling.html#cb19-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="everyday-data-wrangling.html#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(mpg, disp, hp), mean, <span class="at">.names =</span> <span class="st">&quot;mean_{col}&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 3 × 4
##     cyl mean_mpg mean_disp mean_hp
##   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1     4     26.7      105.    82.6
## 2     6     19.7      183.   122. 
## 3     8     15.1      353.   209.</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="everyday-data-wrangling.html#cb21-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="everyday-data-wrangling.html#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), mean, <span class="at">.names =</span> <span class="st">&quot;mean_{col}&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 3 × 11
##     cyl mean_mpg mean_disp mean_hp mean_…¹ mean_wt
##   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1     4     26.7      105.    82.6    4.07    2.29
## 2     6     19.7      183.   122.     3.59    3.12
## 3     8     15.1      353.   209.     3.23    4.00
## # … with 5 more variables: mean_qsec &lt;dbl&gt;,
## #   mean_vs &lt;dbl&gt;, mean_am &lt;dbl&gt;,
## #   mean_gear &lt;dbl&gt;, mean_carb &lt;dbl&gt;, and
## #   abbreviated variable name ¹​mean_drat</code></pre>
<p>Alternatively, in base R, you can use <code>aggregate()</code> with the <code>~</code>; you can read this as <em>grouping mpg by cyl</em> where <em>by</em> corresponds to the <code>~</code>:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="everyday-data-wrangling.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(mpg <span class="sc">~</span> cyl, <span class="at">data =</span> mtcars, <span class="at">FUN =</span> mean)</span></code></pre></div>
<pre><code>##   cyl      mpg
## 1   4 26.66364
## 2   6 19.74286
## 3   8 15.10000</code></pre>
<p>When calculating the size of the groups, you can use <code>n()</code>:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="everyday-data-wrangling.html#cb25-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##     cyl count
##   &lt;dbl&gt; &lt;int&gt;
## 1     4    11
## 2     6     7
## 3     8    14</code></pre>
<p>Filtering by groups of size greater than a certain value:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="everyday-data-wrangling.html#cb27-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span></code></pre></div>
<pre><code>## # A tibble: 25 × 12
##    CAR     mpg   cyl  disp    hp  drat    wt  qsec
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Dats…  22.8     4  108     93  3.85  2.32  18.6
##  2 Horn…  18.7     8  360    175  3.15  3.44  17.0
##  3 Dust…  14.3     8  360    245  3.21  3.57  15.8
##  4 Merc…  24.4     4  147.    62  3.69  3.19  20  
##  5 Merc…  22.8     4  141.    95  3.92  3.15  22.9
##  6 Merc…  16.4     8  276.   180  3.07  4.07  17.4
##  7 Merc…  17.3     8  276.   180  3.07  3.73  17.6
##  8 Merc…  15.2     8  276.   180  3.07  3.78  18  
##  9 Cadi…  10.4     8  472    205  2.93  5.25  18.0
## 10 Linc…  10.4     8  460    215  3     5.42  17.8
## # … with 15 more rows, and 4 more variables:
## #   vs &lt;dbl&gt;, am &lt;dbl&gt;, gear &lt;dbl&gt;, carb &lt;dbl&gt;</code></pre>
</div>
<div id="data-transformation" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Data transformation<a href="everyday-data-wrangling.html#data-transformation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Sometimes it’s useful to transform numeric columns:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="everyday-data-wrangling.html#cb29-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">mpg =</span> mpg<span class="sc">*</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 32 × 12
##    CAR     mpg   cyl  disp    hp  drat    wt  qsec
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Mazd…  42       6  160    110  3.9   2.62  16.5
##  2 Mazd…  42       6  160    110  3.9   2.88  17.0
##  3 Dats…  45.6     4  108     93  3.85  2.32  18.6
##  4 Horn…  42.8     6  258    110  3.08  3.22  19.4
##  5 Horn…  37.4     8  360    175  3.15  3.44  17.0
##  6 Vali…  36.2     6  225    105  2.76  3.46  20.2
##  7 Dust…  28.6     8  360    245  3.21  3.57  15.8
##  8 Merc…  48.8     4  147.    62  3.69  3.19  20  
##  9 Merc…  45.6     4  141.    95  3.92  3.15  22.9
## 10 Merc…  38.4     6  168.   123  3.92  3.44  18.3
## # … with 22 more rows, and 4 more variables:
## #   vs &lt;dbl&gt;, am &lt;dbl&gt;, gear &lt;dbl&gt;, carb &lt;dbl&gt;</code></pre>
<p>Using <code>across()</code> allows for conditional transformation and keep the old columns, while renaming the new columns:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="everyday-data-wrangling.html#cb31-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="everyday-data-wrangling.html#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="cf">function</span>(x) x<span class="sc">*</span><span class="dv">2</span>, <span class="at">.names =</span> <span class="st">&quot;double_{col}&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 32 × 23
##    CAR     mpg   cyl  disp    hp  drat    wt  qsec
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Mazd…  21       6  160    110  3.9   2.62  16.5
##  2 Mazd…  21       6  160    110  3.9   2.88  17.0
##  3 Dats…  22.8     4  108     93  3.85  2.32  18.6
##  4 Horn…  21.4     6  258    110  3.08  3.22  19.4
##  5 Horn…  18.7     8  360    175  3.15  3.44  17.0
##  6 Vali…  18.1     6  225    105  2.76  3.46  20.2
##  7 Dust…  14.3     8  360    245  3.21  3.57  15.8
##  8 Merc…  24.4     4  147.    62  3.69  3.19  20  
##  9 Merc…  22.8     4  141.    95  3.92  3.15  22.9
## 10 Merc…  19.2     6  168.   123  3.92  3.44  18.3
## # … with 22 more rows, and 15 more variables:
## #   vs &lt;dbl&gt;, am &lt;dbl&gt;, gear &lt;dbl&gt;, carb &lt;dbl&gt;,
## #   double_mpg &lt;dbl&gt;, double_cyl &lt;dbl&gt;,
## #   double_disp &lt;dbl&gt;, double_hp &lt;dbl&gt;,
## #   double_drat &lt;dbl&gt;, double_wt &lt;dbl&gt;,
## #   double_qsec &lt;dbl&gt;, double_vs &lt;dbl&gt;,
## #   double_am &lt;dbl&gt;, double_gear &lt;dbl&gt;, …</code></pre>
<p>You can overwrite the existing columns completely; also keep in mind that you can pass any function within <code>across()</code> as such:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="everyday-data-wrangling.html#cb33-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(mpg, disp), <span class="cf">function</span>(x) x<span class="sc">*</span><span class="dv">3</span>))</span></code></pre></div>
<pre><code>## # A tibble: 32 × 12
##    CAR     mpg   cyl  disp    hp  drat    wt  qsec
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Mazd…  63       6  480    110  3.9   2.62  16.5
##  2 Mazd…  63       6  480    110  3.9   2.88  17.0
##  3 Dats…  68.4     4  324     93  3.85  2.32  18.6
##  4 Horn…  64.2     6  774    110  3.08  3.22  19.4
##  5 Horn…  56.1     8 1080    175  3.15  3.44  17.0
##  6 Vali…  54.3     6  675    105  2.76  3.46  20.2
##  7 Dust…  42.9     8 1080    245  3.21  3.57  15.8
##  8 Merc…  73.2     4  440.    62  3.69  3.19  20  
##  9 Merc…  68.4     4  422.    95  3.92  3.15  22.9
## 10 Merc…  57.6     6  503.   123  3.92  3.44  18.3
## # … with 22 more rows, and 4 more variables:
## #   vs &lt;dbl&gt;, am &lt;dbl&gt;, gear &lt;dbl&gt;, carb &lt;dbl&gt;</code></pre>
<p>Iterating across the columns using <code>purrr::modify</code> instead:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="everyday-data-wrangling.html#cb35-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">modify_if</span>(is.numeric, <span class="sc">~</span> .x<span class="sc">*</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 32 × 12
##    CAR     mpg   cyl  disp    hp  drat    wt  qsec
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Mazd…  63      18  480    330 11.7   7.86  49.4
##  2 Mazd…  63      18  480    330 11.7   8.62  51.1
##  3 Dats…  68.4    12  324    279 11.6   6.96  55.8
##  4 Horn…  64.2    18  774    330  9.24  9.64  58.3
##  5 Horn…  56.1    24 1080    525  9.45 10.3   51.1
##  6 Vali…  54.3    18  675    315  8.28 10.4   60.7
##  7 Dust…  42.9    24 1080    735  9.63 10.7   47.5
##  8 Merc…  73.2    12  440.   186 11.1   9.57  60  
##  9 Merc…  68.4    12  422.   285 11.8   9.45  68.7
## 10 Merc…  57.6    18  503.   369 11.8  10.3   54.9
## # … with 22 more rows, and 4 more variables:
## #   vs &lt;dbl&gt;, am &lt;dbl&gt;, gear &lt;dbl&gt;, carb &lt;dbl&gt;</code></pre>
<p>Mutating columns of characters is also straightforward:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="everyday-data-wrangling.html#cb37-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">CAR =</span> <span class="fu">gsub</span>(<span class="st">&#39;Merc&#39;</span>, <span class="st">&#39;Mercedes&#39;</span>, CAR))</span></code></pre></div>
<pre><code>## # A tibble: 32 × 12
##    CAR     mpg   cyl  disp    hp  drat    wt  qsec
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Mazd…  21       6  160    110  3.9   2.62  16.5
##  2 Mazd…  21       6  160    110  3.9   2.88  17.0
##  3 Dats…  22.8     4  108     93  3.85  2.32  18.6
##  4 Horn…  21.4     6  258    110  3.08  3.22  19.4
##  5 Horn…  18.7     8  360    175  3.15  3.44  17.0
##  6 Vali…  18.1     6  225    105  2.76  3.46  20.2
##  7 Dust…  14.3     8  360    245  3.21  3.57  15.8
##  8 Merc…  24.4     4  147.    62  3.69  3.19  20  
##  9 Merc…  22.8     4  141.    95  3.92  3.15  22.9
## 10 Merc…  19.2     6  168.   123  3.92  3.44  18.3
## # … with 22 more rows, and 4 more variables:
## #   vs &lt;dbl&gt;, am &lt;dbl&gt;, gear &lt;dbl&gt;, carb &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="everyday-data-wrangling.html#cb39-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">CAR =</span> <span class="fu">gsub</span>(<span class="st">&#39; &#39;</span>, <span class="st">&#39;_&#39;</span>, CAR)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(CAR, tolower))</span></code></pre></div>
<pre><code>## # A tibble: 32 × 12
##    CAR     mpg   cyl  disp    hp  drat    wt  qsec
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 mazd…  21       6  160    110  3.9   2.62  16.5
##  2 mazd…  21       6  160    110  3.9   2.88  17.0
##  3 dats…  22.8     4  108     93  3.85  2.32  18.6
##  4 horn…  21.4     6  258    110  3.08  3.22  19.4
##  5 horn…  18.7     8  360    175  3.15  3.44  17.0
##  6 vali…  18.1     6  225    105  2.76  3.46  20.2
##  7 dust…  14.3     8  360    245  3.21  3.57  15.8
##  8 merc…  24.4     4  147.    62  3.69  3.19  20  
##  9 merc…  22.8     4  141.    95  3.92  3.15  22.9
## 10 merc…  19.2     6  168.   123  3.92  3.44  18.3
## # … with 22 more rows, and 4 more variables:
## #   vs &lt;dbl&gt;, am &lt;dbl&gt;, gear &lt;dbl&gt;, carb &lt;dbl&gt;</code></pre>
</div>
<div id="joining-and-separating-character-columns" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Joining and separating character columns<a href="everyday-data-wrangling.html#joining-and-separating-character-columns" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For the <code>CAR</code> column comprised of strings, you can separate the individual strings into multiple columns; the <code>extra = 'merge'</code> argument tells the function to separate the string based on the first instance of ” ” and merge the rest:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="everyday-data-wrangling.html#cb41-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">separate</span>(CAR, <span class="fu">c</span>(<span class="st">&#39;Brand&#39;</span>, <span class="st">&#39;Model&#39;</span>), <span class="at">sep =</span> <span class="st">&quot; &quot;</span>, <span class="at">extra =</span> <span class="st">&#39;merge&#39;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 32 × 13
##    Brand Model   mpg   cyl  disp    hp  drat    wt
##    &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Mazda RX4    21       6  160    110  3.9   2.62
##  2 Mazda RX4 …  21       6  160    110  3.9   2.88
##  3 Dats… 710    22.8     4  108     93  3.85  2.32
##  4 Horn… 4 Dr…  21.4     6  258    110  3.08  3.22
##  5 Horn… Spor…  18.7     8  360    175  3.15  3.44
##  6 Vali… &lt;NA&gt;   18.1     6  225    105  2.76  3.46
##  7 Dust… 360    14.3     8  360    245  3.21  3.57
##  8 Merc  240D   24.4     4  147.    62  3.69  3.19
##  9 Merc  230    22.8     4  141.    95  3.92  3.15
## 10 Merc  280    19.2     6  168.   123  3.92  3.44
## # … with 22 more rows, and 5 more variables:
## #   qsec &lt;dbl&gt;, vs &lt;dbl&gt;, am &lt;dbl&gt;, gear &lt;dbl&gt;,
## #   carb &lt;dbl&gt;</code></pre>
<p>Combining multiple <code>tidyverse</code> verbs using the pipe <code>%&gt;%</code>:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="everyday-data-wrangling.html#cb43-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">separate</span>(CAR, <span class="fu">c</span>(<span class="st">&#39;Brand&#39;</span>, <span class="st">&#39;Model&#39;</span>), <span class="at">sep =</span> <span class="st">&quot; &quot;</span>, <span class="at">extra =</span> <span class="st">&#39;merge&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="everyday-data-wrangling.html#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Brand) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">mean_mpg =</span> <span class="fu">mean</span>(mpg)) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="everyday-data-wrangling.html#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(count))</span></code></pre></div>
<pre><code>## # A tibble: 22 × 3
##    Brand    count mean_mpg
##    &lt;chr&gt;    &lt;int&gt;    &lt;dbl&gt;
##  1 Merc         7     19.0
##  2 Fiat         2     29.8
##  3 Hornet       2     20.0
##  4 Mazda        2     21  
##  5 Toyota       2     27.7
##  6 AMC          1     15.2
##  7 Cadillac     1     10.4
##  8 Camaro       1     13.3
##  9 Chrysler     1     14.7
## 10 Datsun       1     22.8
## # … with 12 more rows</code></pre>
<p>Note that the pipe <code>%&gt;%</code> is part of the <code>magrittr</code> package but there’s no need to load it after loading <code>tidyverse</code>. The pipe notation is frequently used between <code>tidyverse</code> verbs but you can also use it in some base R operations as well.</p>
<p>Separation of columns by strings, using base R instead involves using <code>strsplit()</code> which outputs a list and therefore we need to unpack it afterwards:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="everyday-data-wrangling.html#cb45-1" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>Brand <span class="ot">&lt;-</span> <span class="fu">unlist</span>(</span>
<span id="cb45-2"><a href="everyday-data-wrangling.html#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="fu">strsplit</span>(mtcars<span class="sc">$</span>CAR, <span class="at">split =</span> <span class="st">&#39; &#39;</span>), <span class="cf">function</span>(x) x[<span class="dv">1</span>])</span>
<span id="cb45-3"><a href="everyday-data-wrangling.html#cb45-3" aria-hidden="true" tabindex="-1"></a>) <span class="co"># not run</span></span>
<span id="cb45-4"><a href="everyday-data-wrangling.html#cb45-4" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>Model <span class="ot">&lt;-</span> <span class="fu">unlist</span>(</span>
<span id="cb45-5"><a href="everyday-data-wrangling.html#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="fu">strsplit</span>(mtcars<span class="sc">$</span>CAR, <span class="at">split =</span> <span class="st">&#39; &#39;</span>), <span class="cf">function</span>(x) x[<span class="dv">2</span>])</span>
<span id="cb45-6"><a href="everyday-data-wrangling.html#cb45-6" aria-hidden="true" tabindex="-1"></a>) <span class="co"># not run</span></span></code></pre></div>
<p>The opposite of <code>separate()</code> is <code>unite()</code> which combines columns into a single column:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="everyday-data-wrangling.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(iris)</span>
<span id="cb46-2"><a href="everyday-data-wrangling.html#cb46-2" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(iris)</span>
<span id="cb46-3"><a href="everyday-data-wrangling.html#cb46-3" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">%&gt;%</span> <span class="fu">unite</span>(<span class="st">&#39;Petal.Dimensions&#39;</span>, <span class="fu">c</span>(<span class="st">`</span><span class="at">Petal.Length</span><span class="st">`</span>, <span class="st">`</span><span class="at">Petal.Width</span><span class="st">`</span>),</span>
<span id="cb46-4"><a href="everyday-data-wrangling.html#cb46-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">sep =</span> <span class="st">&quot; x &quot;</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 150 × 6
##    Sepal…¹ Sepal…² Petal…³ Petal…⁴ Petal…⁵ Species
##      &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;  
##  1     5.1     3.5 1.4 x …     1.4     0.2 setosa 
##  2     4.9     3   1.4 x …     1.4     0.2 setosa 
##  3     4.7     3.2 1.3 x …     1.3     0.2 setosa 
##  4     4.6     3.1 1.5 x …     1.5     0.2 setosa 
##  5     5       3.6 1.4 x …     1.4     0.2 setosa 
##  6     5.4     3.9 1.7 x …     1.7     0.4 setosa 
##  7     4.6     3.4 1.4 x …     1.4     0.3 setosa 
##  8     5       3.4 1.5 x …     1.5     0.2 setosa 
##  9     4.4     2.9 1.4 x …     1.4     0.2 setosa 
## 10     4.9     3.1 1.5 x …     1.5     0.1 setosa 
## # … with 140 more rows, and abbreviated variable
## #   names ¹​Sepal.Length, ²​Sepal.Width,
## #   ³​Petal.Dimensions, ⁴​Petal.Length,
## #   ⁵​Petal.Width</code></pre>
<p>In base R, we create a new column using the <code>$</code> notation:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="everyday-data-wrangling.html#cb48-1" aria-hidden="true" tabindex="-1"></a>iris<span class="sc">$</span>Petal.Dimensions <span class="ot">&lt;-</span> <span class="fu">paste</span>(iris<span class="sc">$</span>Petal.Length, iris<span class="sc">$</span>Petal.Width, <span class="at">sep =</span> <span class="st">&quot; x &quot;</span>) <span class="co"># not run</span></span></code></pre></div>
</div>
<div id="filtering-rows" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Filtering rows<a href="everyday-data-wrangling.html#filtering-rows" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Typically, filtering involves a condition based on a column to select the corresponding rows. Here I am combining <code>stringr::str_detect</code> with <code>dplyr::filter</code> since the column I am filtering on is a character vector.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="everyday-data-wrangling.html#cb49-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">str_detect</span>(CAR, <span class="st">&#39;Mazda&#39;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 12
##   CAR      mpg   cyl  disp    hp  drat    wt  qsec
##   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Mazda…    21     6   160   110   3.9  2.62  16.5
## 2 Mazda…    21     6   160   110   3.9  2.88  17.0
## # … with 4 more variables: vs &lt;dbl&gt;, am &lt;dbl&gt;,
## #   gear &lt;dbl&gt;, carb &lt;dbl&gt;</code></pre>
<p>Combining <code>filter()</code> with <code>grepl()</code>:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="everyday-data-wrangling.html#cb51-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">str_detect</span>(CAR, <span class="st">&#39;Mazda | Merc&#39;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 12
##   CAR      mpg   cyl  disp    hp  drat    wt  qsec
##   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Mazda…    21     6   160   110   3.9  2.62  16.5
## 2 Mazda…    21     6   160   110   3.9  2.88  17.0
## # … with 4 more variables: vs &lt;dbl&gt;, am &lt;dbl&gt;,
## #   gear &lt;dbl&gt;, carb &lt;dbl&gt;</code></pre>
<p>Ignoring upper/lower case distinction using <code>regex(..., ignore_case = TRUE)</code>:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="everyday-data-wrangling.html#cb53-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">str_detect</span>(CAR, <span class="fu">regex</span>(<span class="st">&#39;mazda&#39;</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 12
##   CAR      mpg   cyl  disp    hp  drat    wt  qsec
##   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Mazda…    21     6   160   110   3.9  2.62  16.5
## 2 Mazda…    21     6   160   110   3.9  2.88  17.0
## # … with 4 more variables: vs &lt;dbl&gt;, am &lt;dbl&gt;,
## #   gear &lt;dbl&gt;, carb &lt;dbl&gt;</code></pre>
<p>Alternatively, using base R using <code>grepl()</code>:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="everyday-data-wrangling.html#cb55-1" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="fu">grepl</span>(<span class="st">&#39;Mazda&#39;</span>, mtcars<span class="sc">$</span>CAR),] <span class="co"># not run</span></span>
<span id="cb55-2"><a href="everyday-data-wrangling.html#cb55-2" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="fu">grepl</span>(<span class="st">&#39;Mazda|Merc&#39;</span>, mtcars<span class="sc">$</span>CAR),] <span class="co"># not run</span></span></code></pre></div>
<p>Using <code>tolower()</code> to make sure we’re on the same page in regards to case:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="everyday-data-wrangling.html#cb56-1" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="fu">grepl</span>(<span class="fu">tolower</span>(<span class="st">&#39;Mazda&#39;</span>), <span class="fu">tolower</span>(mtcars<span class="sc">$</span>CAR)),]</span></code></pre></div>
<pre><code>## # A tibble: 2 × 12
##   CAR      mpg   cyl  disp    hp  drat    wt  qsec
##   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Mazda…    21     6   160   110   3.9  2.62  16.5
## 2 Mazda…    21     6   160   110   3.9  2.88  17.0
## # … with 4 more variables: vs &lt;dbl&gt;, am &lt;dbl&gt;,
## #   gear &lt;dbl&gt;, carb &lt;dbl&gt;</code></pre>
<p>Filtering rows based on a numeric column:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="everyday-data-wrangling.html#cb58-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">between</span>(mpg, <span class="dv">18</span>, <span class="dv">20</span>))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 12
##   CAR      mpg   cyl  disp    hp  drat    wt  qsec
##   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Horne…  18.7     8  360    175  3.15  3.44  17.0
## 2 Valia…  18.1     6  225    105  2.76  3.46  20.2
## 3 Merc …  19.2     6  168.   123  3.92  3.44  18.3
## 4 Ponti…  19.2     8  400    175  3.08  3.84  17.0
## 5 Ferra…  19.7     6  145    175  3.62  2.77  15.5
## # … with 4 more variables: vs &lt;dbl&gt;, am &lt;dbl&gt;,
## #   gear &lt;dbl&gt;, carb &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="everyday-data-wrangling.html#cb60-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">filter</span>(cyl <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">8</span>))</span></code></pre></div>
<pre><code>## # A tibble: 21 × 12
##    CAR     mpg   cyl  disp    hp  drat    wt  qsec
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Mazd…  21       6  160    110  3.9   2.62  16.5
##  2 Mazd…  21       6  160    110  3.9   2.88  17.0
##  3 Horn…  21.4     6  258    110  3.08  3.22  19.4
##  4 Horn…  18.7     8  360    175  3.15  3.44  17.0
##  5 Vali…  18.1     6  225    105  2.76  3.46  20.2
##  6 Dust…  14.3     8  360    245  3.21  3.57  15.8
##  7 Merc…  19.2     6  168.   123  3.92  3.44  18.3
##  8 Merc…  17.8     6  168.   123  3.92  3.44  18.9
##  9 Merc…  16.4     8  276.   180  3.07  4.07  17.4
## 10 Merc…  17.3     8  276.   180  3.07  3.73  17.6
## # … with 11 more rows, and 4 more variables:
## #   vs &lt;dbl&gt;, am &lt;dbl&gt;, gear &lt;dbl&gt;, carb &lt;dbl&gt;</code></pre>
<p>Alternatively, in base R, using <code>which()</code>:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="everyday-data-wrangling.html#cb62-1" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="fu">which</span>(mtcars<span class="sc">$</span>mpg <span class="sc">&gt;</span> <span class="dv">18</span> <span class="sc">&amp;</span> mtcars<span class="sc">$</span>mpg <span class="sc">&lt;</span> <span class="dv">20</span>),] <span class="co"># not run</span></span>
<span id="cb62-2"><a href="everyday-data-wrangling.html#cb62-2" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="fu">which</span>(mtcars<span class="sc">$</span>cyl <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">8</span>)),] <span class="co"># not run</span></span></code></pre></div>
</div>
<div id="subsetting-columns-based-on-strings" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> Subsetting columns based on strings<a href="everyday-data-wrangling.html#subsetting-columns-based-on-strings" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Subsetting columns typically involves using square brackets <code>[ ]</code> in base R, but can be done easily with <code>dplyr::select</code>; <code>select()</code> supports multiple helper functions such as <code>starts_with()</code>, <code>ends_with()</code>, and <code>match()</code>.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="everyday-data-wrangling.html#cb63-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&#39;m&#39;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 32 × 2
##      mpg    am
##    &lt;dbl&gt; &lt;dbl&gt;
##  1  21       1
##  2  21       1
##  3  22.8     1
##  4  21.4     0
##  5  18.7     0
##  6  18.1     0
##  7  14.3     0
##  8  24.4     0
##  9  22.8     0
## 10  19.2     0
## # … with 22 more rows</code></pre>
<p>You can use multiple helper functions at once:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="everyday-data-wrangling.html#cb65-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&#39;m&#39;</span>), <span class="fu">ends_with</span>(<span class="st">&#39;c&#39;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 32 × 2
##      mpg  qsec
##    &lt;dbl&gt; &lt;dbl&gt;
##  1  21    16.5
##  2  21    17.0
##  3  22.8  18.6
##  4  21.4  19.4
##  5  18.7  17.0
##  6  18.1  20.2
##  7  14.3  15.8
##  8  24.4  20  
##  9  22.8  22.9
## 10  19.2  18.3
## # … with 22 more rows</code></pre>
<p>Using regex, with the anchors <code>^</code> and <code>$</code>:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="everyday-data-wrangling.html#cb67-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">&#39;^m&#39;</span>), <span class="fu">matches</span>(<span class="st">&#39;c$&#39;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 32 × 2
##      mpg  qsec
##    &lt;dbl&gt; &lt;dbl&gt;
##  1  21    16.5
##  2  21    17.0
##  3  22.8  18.6
##  4  21.4  19.4
##  5  18.7  17.0
##  6  18.1  20.2
##  7  14.3  15.8
##  8  24.4  20  
##  9  22.8  22.9
## 10  19.2  18.3
## # … with 22 more rows</code></pre>
<p>Alternatively, in base R and regex:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="everyday-data-wrangling.html#cb69-1" aria-hidden="true" tabindex="-1"></a>mtcars[,<span class="fu">grepl</span>(<span class="st">&#39;^m|c$&#39;</span>, <span class="fu">names</span>(mtcars))]</span></code></pre></div>
<pre><code>## # A tibble: 32 × 2
##      mpg  qsec
##    &lt;dbl&gt; &lt;dbl&gt;
##  1  21    16.5
##  2  21    17.0
##  3  22.8  18.6
##  4  21.4  19.4
##  5  18.7  17.0
##  6  18.1  20.2
##  7  14.3  15.8
##  8  24.4  20  
##  9  22.8  22.9
## 10  19.2  18.3
## # … with 22 more rows</code></pre>
</div>
<div id="long-and-wide-data-formats" class="section level2 hasAnchor" number="2.7">
<h2><span class="header-section-number">2.7</span> Long and wide data formats<a href="everyday-data-wrangling.html#long-and-wide-data-formats" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Transforming datasets into long/wide formats is a typical task in EDA, and this can be done using <code>tidyr</code>:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="everyday-data-wrangling.html#cb71-1" aria-hidden="true" tabindex="-1"></a>mtcars_long <span class="ot">&lt;-</span> mtcars <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="at">names_to =</span> <span class="st">&#39;Metric&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;Values&#39;</span>)</span>
<span id="cb71-2"><a href="everyday-data-wrangling.html#cb71-2" aria-hidden="true" tabindex="-1"></a>mtcars_long</span></code></pre></div>
<pre><code>## # A tibble: 352 × 3
##    CAR       Metric Values
##    &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt;
##  1 Mazda RX4 mpg     21   
##  2 Mazda RX4 cyl      6   
##  3 Mazda RX4 disp   160   
##  4 Mazda RX4 hp     110   
##  5 Mazda RX4 drat     3.9 
##  6 Mazda RX4 wt       2.62
##  7 Mazda RX4 qsec    16.5 
##  8 Mazda RX4 vs       0   
##  9 Mazda RX4 am       1   
## 10 Mazda RX4 gear     4   
## # … with 342 more rows</code></pre>
<p>Having the dataset in this long format allows us to create visualizations such as the boxplot much easier.</p>
<p>Pivoting the long format back to a wide format as also straightforward with <code>tidyr</code>:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="everyday-data-wrangling.html#cb73-1" aria-hidden="true" tabindex="-1"></a>mtcars_wide <span class="ot">&lt;-</span> mtcars_long <span class="sc">%&gt;%</span> </span>
<span id="cb73-2"><a href="everyday-data-wrangling.html#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&#39;Metric&#39;</span>, <span class="at">values_from =</span> <span class="st">&#39;Values&#39;</span>)</span>
<span id="cb73-3"><a href="everyday-data-wrangling.html#cb73-3" aria-hidden="true" tabindex="-1"></a>mtcars_wide</span></code></pre></div>
<pre><code>## # A tibble: 32 × 12
##    CAR     mpg   cyl  disp    hp  drat    wt  qsec
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Mazd…  21       6  160    110  3.9   2.62  16.5
##  2 Mazd…  21       6  160    110  3.9   2.88  17.0
##  3 Dats…  22.8     4  108     93  3.85  2.32  18.6
##  4 Horn…  21.4     6  258    110  3.08  3.22  19.4
##  5 Horn…  18.7     8  360    175  3.15  3.44  17.0
##  6 Vali…  18.1     6  225    105  2.76  3.46  20.2
##  7 Dust…  14.3     8  360    245  3.21  3.57  15.8
##  8 Merc…  24.4     4  147.    62  3.69  3.19  20  
##  9 Merc…  22.8     4  141.    95  3.92  3.15  22.9
## 10 Merc…  19.2     6  168.   123  3.92  3.44  18.3
## # … with 22 more rows, and 4 more variables:
## #   vs &lt;dbl&gt;, am &lt;dbl&gt;, gear &lt;dbl&gt;, carb &lt;dbl&gt;</code></pre>
<p>In base R, you can use <code>reshape()</code> with the argument <code>direction =</code> but I don’t find its syntax very intuitive. Alternatively, using <code>data.table</code> gets us the solution much easier:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="everyday-data-wrangling.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span></code></pre></div>
<pre><code>## data.table 1.14.0 using 1 threads (see ?getDTthreads).  Latest news: r-datatable.com</code></pre>
<pre><code>## **********
## This installation of data.table has not detected OpenMP support. It should still work but in single-threaded mode.
## This is a Mac. Please read https://mac.r-project.org/openmp/. Please engage with Apple and ask them for support. Check r-datatable.com for updates, and our Mac instructions here: https://github.com/Rdatatable/data.table/wiki/Installation. After several years of many reports of installation problems on Mac, it&#39;s time to gingerly point out that there have been no similar problems on Windows or Linux.
## **********</code></pre>
<pre><code>## 
## Attaching package: &#39;data.table&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     between, first, last</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     transpose</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="everyday-data-wrangling.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">melt</span>(<span class="fu">setDT</span>(mtcars), <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&#39;CAR&#39;</span>), <span class="at">variable.name =</span> <span class="st">&#39;Metric&#39;</span>)</span></code></pre></div>
<pre><code>##                    CAR Metric value
##   1:         Mazda RX4    mpg  21.0
##   2:     Mazda RX4 Wag    mpg  21.0
##   3:        Datsun 710    mpg  22.8
##   4:    Hornet 4 Drive    mpg  21.4
##   5: Hornet Sportabout    mpg  18.7
##  ---                               
## 348:      Lotus Europa   carb   2.0
## 349:    Ford Pantera L   carb   4.0
## 350:      Ferrari Dino   carb   6.0
## 351:     Maserati Bora   carb   8.0
## 352:        Volvo 142E   carb   2.0</code></pre>
<p>Note that using <code>data.table</code> returns a <code>data.table</code> object (due to the <code>setDT()</code> function), which differs from the <code>tibble</code> we’ve been using for packages within <code>tidyverse</code>. There are some advantages to using <code>data.table</code> instead, especially when working with very large datasets. For the sake of this book I will mostly use base R and <code>tidyverse</code>, other than exceptional cases.</p>
</div>
<div id="trimming-strings" class="section level2 hasAnchor" number="2.8">
<h2><span class="header-section-number">2.8</span> Trimming strings<a href="everyday-data-wrangling.html#trimming-strings" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Trimming character columns, then re-encoding them as factors:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="everyday-data-wrangling.html#cb83-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Species =</span> <span class="fu">strtrim</span>(Species, <span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb83-2"><a href="everyday-data-wrangling.html#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Species =</span> <span class="fu">factor</span>(Species, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&#39;set&#39;</span>, <span class="st">&#39;ver&#39;</span>, <span class="st">&#39;vir&#39;</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 150 × 5
##    Sepal.Length Sepal.Wi…¹ Petal…² Petal…³ Species
##           &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;  
##  1          5.1        3.5     1.4     0.2 set    
##  2          4.9        3       1.4     0.2 set    
##  3          4.7        3.2     1.3     0.2 set    
##  4          4.6        3.1     1.5     0.2 set    
##  5          5          3.6     1.4     0.2 set    
##  6          5.4        3.9     1.7     0.4 set    
##  7          4.6        3.4     1.4     0.3 set    
##  8          5          3.4     1.5     0.2 set    
##  9          4.4        2.9     1.4     0.2 set    
## 10          4.9        3.1     1.5     0.1 set    
## # … with 140 more rows, and abbreviated variable
## #   names ¹​Sepal.Width, ²​Petal.Length,
## #   ³​Petal.Width</code></pre>
<p>Sometimes when you’re importing datasets from external and/or untrustworthy sources (e.g., an Excel sheet) it’s worth checking for any whitespaces. In that case you can use <code>stringr::str_trim</code> to remove all whitespaces prior to data analysis.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="everyday-data-wrangling.html#cb85-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Species =</span> <span class="fu">str_trim</span>(Species))</span></code></pre></div>
<pre><code>## # A tibble: 150 × 5
##    Sepal.Length Sepal.Wi…¹ Petal…² Petal…³ Species
##           &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;  
##  1          5.1        3.5     1.4     0.2 setosa 
##  2          4.9        3       1.4     0.2 setosa 
##  3          4.7        3.2     1.3     0.2 setosa 
##  4          4.6        3.1     1.5     0.2 setosa 
##  5          5          3.6     1.4     0.2 setosa 
##  6          5.4        3.9     1.7     0.4 setosa 
##  7          4.6        3.4     1.4     0.3 setosa 
##  8          5          3.4     1.5     0.2 setosa 
##  9          4.4        2.9     1.4     0.2 setosa 
## 10          4.9        3.1     1.5     0.1 setosa 
## # … with 140 more rows, and abbreviated variable
## #   names ¹​Sepal.Width, ²​Petal.Length,
## #   ³​Petal.Width</code></pre>
</div>
<div id="iterating-over-list-of-dataframes" class="section level2 hasAnchor" number="2.9">
<h2><span class="header-section-number">2.9</span> Iterating over list of dataframes<a href="everyday-data-wrangling.html#iterating-over-list-of-dataframes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Analogously to base R’s <code>split</code>, using <code>group_split()</code> allows us to convert the dataset to a list based on a column; the length of this output list would correspond to the unique number of column entries:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="everyday-data-wrangling.html#cb87-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(mtcars)</span>
<span id="cb87-2"><a href="everyday-data-wrangling.html#cb87-2" aria-hidden="true" tabindex="-1"></a>mtcars_lst <span class="ot">&lt;-</span> mtcars <span class="sc">%&gt;%</span> <span class="fu">group_split</span>(cyl)</span></code></pre></div>
<p>Iteration will be covered in more detail in a future chapter, but using base R’s <code>apply</code> family is straightforward. In this case since we’re working with lists, we will use <code>lapply()</code> and pass a function (in this case, <code>rename_with()</code>):</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="everyday-data-wrangling.html#cb88-1" aria-hidden="true" tabindex="-1"></a>mtcars_lst <span class="ot">&lt;-</span> <span class="fu">lapply</span>(mtcars_lst, <span class="cf">function</span>(x) </span>
<span id="cb88-2"><a href="everyday-data-wrangling.html#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(x, <span class="cf">function</span>(y) <span class="fu">paste0</span>(y, <span class="st">&quot;_&quot;</span>, <span class="fu">as.character</span>(<span class="fu">unique</span>(x<span class="sc">$</span>cyl))), <span class="at">.cols =</span> <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb88-3"><a href="everyday-data-wrangling.html#cb88-3" aria-hidden="true" tabindex="-1"></a>mtcars_lst[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## # A tibble: 11 × 12
##    CAR       mpg_4 cyl_4 disp_4  hp_4 drat_4  wt_4
##    &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1 Datsun 7…  22.8     4  108      93   3.85  2.32
##  2 Merc 240D  24.4     4  147.     62   3.69  3.19
##  3 Merc 230   22.8     4  141.     95   3.92  3.15
##  4 Fiat 128   32.4     4   78.7    66   4.08  2.2 
##  5 Honda Ci…  30.4     4   75.7    52   4.93  1.62
##  6 Toyota C…  33.9     4   71.1    65   4.22  1.84
##  7 Toyota C…  21.5     4  120.     97   3.7   2.46
##  8 Fiat X1-9  27.3     4   79      66   4.08  1.94
##  9 Porsche …  26       4  120.     91   4.43  2.14
## 10 Lotus Eu…  30.4     4   95.1   113   3.77  1.51
## 11 Volvo 14…  21.4     4  121     109   4.11  2.78
## # … with 5 more variables: qsec_4 &lt;dbl&gt;,
## #   vs_4 &lt;dbl&gt;, am_4 &lt;dbl&gt;, gear_4 &lt;dbl&gt;,
## #   carb_4 &lt;dbl&gt;</code></pre>
<p>A <code>tidyverse</code> alternative to <code>apply</code> is <code>purrr::map</code> and its variations:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="everyday-data-wrangling.html#cb90-1" aria-hidden="true" tabindex="-1"></a>mtcars_lst <span class="ot">&lt;-</span> mtcars <span class="sc">%&gt;%</span> <span class="fu">group_split</span>(cyl)</span>
<span id="cb90-2"><a href="everyday-data-wrangling.html#cb90-2" aria-hidden="true" tabindex="-1"></a>mtcars_lst <span class="ot">&lt;-</span> mtcars_lst <span class="sc">%&gt;%</span> </span>
<span id="cb90-3"><a href="everyday-data-wrangling.html#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">rename_with</span>(.x, <span class="cf">function</span>(y) <span class="fu">paste0</span>(y, <span class="st">&quot;_&quot;</span>, <span class="fu">as.character</span>(<span class="fu">unique</span>(.x<span class="sc">$</span>cyl))), </span>
<span id="cb90-4"><a href="everyday-data-wrangling.html#cb90-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">.cols =</span> <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb90-5"><a href="everyday-data-wrangling.html#cb90-5" aria-hidden="true" tabindex="-1"></a>mtcars_lst[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## # A tibble: 11 × 12
##    CAR       mpg_4 cyl_4 disp_4  hp_4 drat_4  wt_4
##    &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1 Datsun 7…  22.8     4  108      93   3.85  2.32
##  2 Merc 240D  24.4     4  147.     62   3.69  3.19
##  3 Merc 230   22.8     4  141.     95   3.92  3.15
##  4 Fiat 128   32.4     4   78.7    66   4.08  2.2 
##  5 Honda Ci…  30.4     4   75.7    52   4.93  1.62
##  6 Toyota C…  33.9     4   71.1    65   4.22  1.84
##  7 Toyota C…  21.5     4  120.     97   3.7   2.46
##  8 Fiat X1-9  27.3     4   79      66   4.08  1.94
##  9 Porsche …  26       4  120.     91   4.43  2.14
## 10 Lotus Eu…  30.4     4   95.1   113   3.77  1.51
## 11 Volvo 14…  21.4     4  121     109   4.11  2.78
## # … with 5 more variables: qsec_4 &lt;dbl&gt;,
## #   vs_4 &lt;dbl&gt;, am_4 &lt;dbl&gt;, gear_4 &lt;dbl&gt;,
## #   carb_4 &lt;dbl&gt;</code></pre>
<p>Fitting a linear model is easy using iterations; in this case we fit <code>lm()</code> on the variables <code>mpg</code> and <code>gear</code> to identify their relationship:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="everyday-data-wrangling.html#cb92-1" aria-hidden="true" tabindex="-1"></a>mtcars_lst <span class="ot">&lt;-</span> mtcars <span class="sc">%&gt;%</span> <span class="fu">group_split</span>(cyl)</span>
<span id="cb92-2"><a href="everyday-data-wrangling.html#cb92-2" aria-hidden="true" tabindex="-1"></a>mtcars_lst <span class="sc">%&gt;%</span> </span>
<span id="cb92-3"><a href="everyday-data-wrangling.html#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> gear, <span class="at">data =</span> .x)) <span class="sc">%&gt;%</span></span>
<span id="cb92-4"><a href="everyday-data-wrangling.html#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(coef)</span></code></pre></div>
<pre><code>## [[1]]
## (Intercept)        gear 
##    15.08125     2.83125 
## 
## [[2]]
## (Intercept)        gear 
##       19.82       -0.02 
## 
## [[3]]
## (Intercept)        gear 
##      14.525       0.175</code></pre>
<p>Using <code>broom::tidy</code> to clean up modelling result and output the model estimates:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="everyday-data-wrangling.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb94-2"><a href="everyday-data-wrangling.html#cb94-2" aria-hidden="true" tabindex="-1"></a>mtcars_lst <span class="sc">%&gt;%</span></span>
<span id="cb94-3"><a href="everyday-data-wrangling.html#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> gear, <span class="at">data =</span> .x)) <span class="sc">%&gt;%</span></span>
<span id="cb94-4"><a href="everyday-data-wrangling.html#cb94-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(tidy) <span class="sc">%&gt;%</span></span>
<span id="cb94-5"><a href="everyday-data-wrangling.html#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   term        estimate std.error statistic p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 (Intercept)  15.1       10.8      1.39   0.197  
## 2 gear          2.83       2.62     1.08   0.308  
## 3 (Intercept)  19.8        3.68     5.38   0.00299
## 4 gear         -0.0200     0.942   -0.0212 0.984  
## 5 (Intercept)  14.5        3.41     4.25   0.00112
## 6 gear          0.175      1.02     0.172  0.866</code></pre>
<p>Using base R and the <code>apply</code> family instead:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="everyday-data-wrangling.html#cb96-1" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">lapply</span>(mtcars_lst, <span class="cf">function</span>(x) <span class="fu">lm</span>(mpg <span class="sc">~</span> gear, <span class="at">data =</span> x))</span>
<span id="cb96-2"><a href="everyday-data-wrangling.html#cb96-2" aria-hidden="true" tabindex="-1"></a>coefs <span class="ot">&lt;-</span> <span class="fu">lapply</span>(models, coef)</span>
<span id="cb96-3"><a href="everyday-data-wrangling.html#cb96-3" aria-hidden="true" tabindex="-1"></a>coefs[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## (Intercept)        gear 
##    15.08125     2.83125</code></pre>
</div>
<div id="rowwise-operations" class="section level2 hasAnchor" number="2.10">
<h2><span class="header-section-number">2.10</span> Rowwise operations<a href="everyday-data-wrangling.html#rowwise-operations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="everyday-data-wrangling.html#cb98-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&#39;Brian&#39;</span>, <span class="st">&#39;Connor&#39;</span>),</span>
<span id="cb98-2"><a href="everyday-data-wrangling.html#cb98-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">coffee =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">2</span>),</span>
<span id="cb98-3"><a href="everyday-data-wrangling.html#cb98-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">wine =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">2</span>),</span>
<span id="cb98-4"><a href="everyday-data-wrangling.html#cb98-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">juice =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">2</span>))</span>
<span id="cb98-5"><a href="everyday-data-wrangling.html#cb98-5" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>## # A tibble: 2 × 4
##   name   coffee  wine juice
##   &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1 Brian      10     1     4
## 2 Connor      1     4     3</code></pre>
<p>Sometimes it’s useful to run calculations in a row-wise fashion; for example using <code>mutate()</code> with the helper function <code>c_across()</code>:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="everyday-data-wrangling.html#cb100-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">total =</span> <span class="fu">sum</span>(<span class="fu">c_across</span>(coffee<span class="sc">:</span>juice)),</span>
<span id="cb100-2"><a href="everyday-data-wrangling.html#cb100-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">avg =</span> <span class="fu">mean</span>(<span class="fu">c_across</span>(coffee<span class="sc">:</span>juice)))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 6
## # Rowwise: 
##   name   coffee  wine juice total   avg
##   &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
## 1 Brian      10     1     4    15  5   
## 2 Connor      1     4     3     8  2.67</code></pre>
<p>Calculating the proportions using a combination of row-wise and column-wise operations with <code>c_across()</code> and <code>across()</code>:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="everyday-data-wrangling.html#cb102-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">total =</span> <span class="fu">sum</span>(<span class="fu">c_across</span>(coffee<span class="sc">:</span>juice))) <span class="sc">%&gt;%</span></span>
<span id="cb102-2"><a href="everyday-data-wrangling.html#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb102-3"><a href="everyday-data-wrangling.html#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(coffee<span class="sc">:</span>juice, <span class="cf">function</span>(x) x<span class="sc">/</span>total,</span>
<span id="cb102-4"><a href="everyday-data-wrangling.html#cb102-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">.names =</span> <span class="st">&quot;{col}_prop.&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 8
##   name   coffee  wine juice total coffee…¹ wine_…²
##   &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;dbl&gt;   &lt;dbl&gt;
## 1 Brian      10     1     4    15    0.667  0.0667
## 2 Connor      1     4     3     8    0.125  0.5   
## # … with 1 more variable: juice_prop. &lt;dbl&gt;, and
## #   abbreviated variable names ¹​coffee_prop.,
## #   ²​wine_prop.</code></pre>
</div>
<div id="conditional-transformation" class="section level2 hasAnchor" number="2.11">
<h2><span class="header-section-number">2.11</span> Conditional transformation<a href="everyday-data-wrangling.html#conditional-transformation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Conditional transformations are useful when creating categories based on a series of logical statements; this is done using <code>case_when()</code> to define the conditions:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="everyday-data-wrangling.html#cb104-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">mileage_class =</span> </span>
<span id="cb104-2"><a href="everyday-data-wrangling.html#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">case_when</span>(mpg <span class="sc">&gt;</span> <span class="dv">20</span> <span class="sc">~</span> <span class="st">&#39;High&#39;</span>,</span>
<span id="cb104-3"><a href="everyday-data-wrangling.html#cb104-3" aria-hidden="true" tabindex="-1"></a>            mpg <span class="sc">&lt;</span> <span class="dv">20</span> <span class="sc">~</span> <span class="st">&#39;Low&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb104-4"><a href="everyday-data-wrangling.html#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(mileage_class, <span class="at">.after =</span> mpg)</span></code></pre></div>
<pre><code>## # A tibble: 32 × 13
##    CAR         mpg milea…¹   cyl  disp    hp  drat
##    &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Mazda RX4  21   High        6  160    110  3.9 
##  2 Mazda RX…  21   High        6  160    110  3.9 
##  3 Datsun 7…  22.8 High        4  108     93  3.85
##  4 Hornet 4…  21.4 High        6  258    110  3.08
##  5 Hornet S…  18.7 Low         8  360    175  3.15
##  6 Valiant    18.1 Low         6  225    105  2.76
##  7 Duster 3…  14.3 Low         8  360    245  3.21
##  8 Merc 240D  24.4 High        4  147.    62  3.69
##  9 Merc 230   22.8 High        4  141.    95  3.92
## 10 Merc 280   19.2 Low         6  168.   123  3.92
## # … with 22 more rows, 6 more variables:
## #   wt &lt;dbl&gt;, qsec &lt;dbl&gt;, vs &lt;dbl&gt;, am &lt;dbl&gt;,
## #   gear &lt;dbl&gt;, carb &lt;dbl&gt;, and abbreviated
## #   variable name ¹​mileage_class</code></pre>
<p>In cases where we’re working with character columns, it’s useful to use <code>grepl</code> to match specific strings. After all, formula within <code>case_when()</code> needs to evaluate to a boolean on the left-hand side (e.g., <code>mpg &gt; 20</code>). Additionally, in cases where the condition is not specified or met, you can use <code>TRUE ~</code> within <code>case_when()</code> as such:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="everyday-data-wrangling.html#cb106-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">CAR =</span> <span class="fu">case_when</span>(<span class="fu">grepl</span>(<span class="st">&#39;Merc&#39;</span>, CAR) <span class="sc">~</span> <span class="fu">toupper</span>(CAR), <span class="cn">TRUE</span> <span class="sc">~</span> CAR))</span></code></pre></div>
<pre><code>## # A tibble: 32 × 12
##    CAR     mpg   cyl  disp    hp  drat    wt  qsec
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Mazd…  21       6  160    110  3.9   2.62  16.5
##  2 Mazd…  21       6  160    110  3.9   2.88  17.0
##  3 Dats…  22.8     4  108     93  3.85  2.32  18.6
##  4 Horn…  21.4     6  258    110  3.08  3.22  19.4
##  5 Horn…  18.7     8  360    175  3.15  3.44  17.0
##  6 Vali…  18.1     6  225    105  2.76  3.46  20.2
##  7 Dust…  14.3     8  360    245  3.21  3.57  15.8
##  8 MERC…  24.4     4  147.    62  3.69  3.19  20  
##  9 MERC…  22.8     4  141.    95  3.92  3.15  22.9
## 10 MERC…  19.2     6  168.   123  3.92  3.44  18.3
## # … with 22 more rows, and 4 more variables:
## #   vs &lt;dbl&gt;, am &lt;dbl&gt;, gear &lt;dbl&gt;, carb &lt;dbl&gt;</code></pre>
<p>Conditional mutate using base R involves using <code>ifelse()</code>:</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="everyday-data-wrangling.html#cb108-1" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>mileage_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb108-2"><a href="everyday-data-wrangling.html#cb108-2" aria-hidden="true" tabindex="-1"></a>  mtcars<span class="sc">$</span>mpg <span class="sc">&gt;</span> <span class="dv">20</span>, <span class="st">&#39;High&#39;</span>, <span class="st">&#39;Low&#39;</span></span>
<span id="cb108-3"><a href="everyday-data-wrangling.html#cb108-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb108-4"><a href="everyday-data-wrangling.html#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(mtcars, <span class="at">select =</span> <span class="fu">c</span>(CAR, mpg, mileage_class, cyl<span class="sc">:</span>carb))</span></code></pre></div>
<pre><code>## # A tibble: 32 × 13
##    CAR         mpg milea…¹   cyl  disp    hp  drat
##    &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Mazda RX4  21   High        6  160    110  3.9 
##  2 Mazda RX…  21   High        6  160    110  3.9 
##  3 Datsun 7…  22.8 High        4  108     93  3.85
##  4 Hornet 4…  21.4 High        6  258    110  3.08
##  5 Hornet S…  18.7 Low         8  360    175  3.15
##  6 Valiant    18.1 Low         6  225    105  2.76
##  7 Duster 3…  14.3 Low         8  360    245  3.21
##  8 Merc 240D  24.4 High        4  147.    62  3.69
##  9 Merc 230   22.8 High        4  141.    95  3.92
## 10 Merc 280   19.2 Low         6  168.   123  3.92
## # … with 22 more rows, 6 more variables:
## #   wt &lt;dbl&gt;, qsec &lt;dbl&gt;, vs &lt;dbl&gt;, am &lt;dbl&gt;,
## #   gear &lt;dbl&gt;, carb &lt;dbl&gt;, and abbreviated
## #   variable name ¹​mileage_class</code></pre>
</div>
<div id="missing-values" class="section level2 hasAnchor" number="2.12">
<h2><span class="header-section-number">2.12</span> Missing values<a href="everyday-data-wrangling.html#missing-values" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Handling missing values is tedious but often required when working with dodgy data.</p>
<p>First, for the sake of our exercise we insert NAs randomly in the <code>mtcars</code> dataset:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="everyday-data-wrangling.html#cb110-1" aria-hidden="true" tabindex="-1"></a>mtcars_NA <span class="ot">&lt;-</span> <span class="fu">map_df</span>(mtcars, <span class="cf">function</span>(x) </span>
<span id="cb110-2"><a href="everyday-data-wrangling.html#cb110-2" aria-hidden="true" tabindex="-1"></a>  {x[<span class="fu">sample</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">NA</span>), <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.95</span>, <span class="fl">0.01</span>), <span class="at">size =</span> <span class="fu">length</span>(x), <span class="at">replace =</span> <span class="cn">TRUE</span>)]})</span>
<span id="cb110-3"><a href="everyday-data-wrangling.html#cb110-3" aria-hidden="true" tabindex="-1"></a>mtcars_NA</span></code></pre></div>
<pre><code>## # A tibble: 32 × 13
##    CAR     mpg   cyl  disp    hp  drat    wt  qsec
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Mazd…  21       6  160    110  3.9   2.62  16.5
##  2 Mazd…  21       6  160    110  3.9   2.88  17.0
##  3 Dats…  22.8     4  108     93  3.85  2.32  18.6
##  4 Horn…  21.4     6  258    110 NA     3.22  19.4
##  5 Horn…  18.7     8  360    175  3.15  3.44  17.0
##  6 Vali…  18.1     6  225    105  2.76  3.46  20.2
##  7 Dust…  14.3     8  360    245  3.21  3.57  15.8
##  8 Merc…  24.4     4  147.    62  3.69  3.19  20  
##  9 Merc…  22.8     4  141.    95  3.92  3.15  22.9
## 10 Merc…  19.2     6  168.   123  3.92  3.44  18.3
## # … with 22 more rows, and 5 more variables:
## #   vs &lt;dbl&gt;, am &lt;dbl&gt;, gear &lt;dbl&gt;, carb &lt;dbl&gt;,
## #   mileage_class &lt;chr&gt;</code></pre>
<p>Remove rows where any NA occurs:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="everyday-data-wrangling.html#cb112-1" aria-hidden="true" tabindex="-1"></a>mtcars_NA <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>()</span></code></pre></div>
<pre><code>## # A tibble: 28 × 13
##    CAR     mpg   cyl  disp    hp  drat    wt  qsec
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Mazd…  21       6  160    110  3.9   2.62  16.5
##  2 Mazd…  21       6  160    110  3.9   2.88  17.0
##  3 Horn…  18.7     8  360    175  3.15  3.44  17.0
##  4 Vali…  18.1     6  225    105  2.76  3.46  20.2
##  5 Dust…  14.3     8  360    245  3.21  3.57  15.8
##  6 Merc…  24.4     4  147.    62  3.69  3.19  20  
##  7 Merc…  22.8     4  141.    95  3.92  3.15  22.9
##  8 Merc…  19.2     6  168.   123  3.92  3.44  18.3
##  9 Merc…  17.8     6  168.   123  3.92  3.44  18.9
## 10 Merc…  16.4     8  276.   180  3.07  4.07  17.4
## # … with 18 more rows, and 5 more variables:
## #   vs &lt;dbl&gt;, am &lt;dbl&gt;, gear &lt;dbl&gt;, carb &lt;dbl&gt;,
## #   mileage_class &lt;chr&gt;</code></pre>
<p>Identify columns with NAs and the number of occurrences:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="everyday-data-wrangling.html#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vapply</span>(mtcars_NA, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)), <span class="fu">double</span>(<span class="dv">1</span>))</span></code></pre></div>
<pre><code>##           CAR           mpg           cyl 
##             0             1             0 
##          disp            hp          drat 
##             0             0             1 
##            wt          qsec            vs 
##             0             1             1 
##            am          gear          carb 
##             0             1             0 
## mileage_class 
##             0</code></pre>
<p>Remove columns with more than one missing value:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="everyday-data-wrangling.html#cb116-1" aria-hidden="true" tabindex="-1"></a>mtcars_NA <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">where</span>(<span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)) <span class="sc">&lt;</span> <span class="dv">1</span>))</span></code></pre></div>
<pre><code>## # A tibble: 32 × 8
##    CAR           cyl  disp    hp    wt    am  carb
##    &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Mazda RX4       6  160    110  2.62     1     4
##  2 Mazda RX4 …     6  160    110  2.88     1     4
##  3 Datsun 710      4  108     93  2.32     1     1
##  4 Hornet 4 D…     6  258    110  3.22     0     1
##  5 Hornet Spo…     8  360    175  3.44     0     2
##  6 Valiant         6  225    105  3.46     0     1
##  7 Duster 360      8  360    245  3.57     0     4
##  8 Merc 240D       4  147.    62  3.19     0     2
##  9 Merc 230        4  141.    95  3.15     0     2
## 10 Merc 280        6  168.   123  3.44     0     4
## # … with 22 more rows, and 1 more variable:
## #   mileage_class &lt;chr&gt;</code></pre>
<p>Replace missing values with zero using <code>tidyr::replace_na</code>:</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="everyday-data-wrangling.html#cb118-1" aria-hidden="true" tabindex="-1"></a>mtcars_NA <span class="sc">%&gt;%</span> <span class="fu">map_dfc</span>(<span class="sc">~</span> <span class="fu">replace_na</span>(.x, <span class="dv">0</span>))</span></code></pre></div>
<p>Base R and using <code>is.na()</code> instead:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="everyday-data-wrangling.html#cb119-1" aria-hidden="true" tabindex="-1"></a>mtcars_NA[<span class="fu">is.na</span>(mtcars_NA)] <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># not run</span></span></code></pre></div>
</div>
<div id="joining-dataframes" class="section level2 hasAnchor" number="2.13">
<h2><span class="header-section-number">2.13</span> Joining dataframes<a href="everyday-data-wrangling.html#joining-dataframes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Mutating joins in <code>tidyverse</code> are analogous to the inner and outer joins in SQL syntax:</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="everyday-data-wrangling.html#cb120-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb120-2"><a href="everyday-data-wrangling.html#cb120-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">&#39;Brian&#39;</span>, <span class="st">&#39;Connor&#39;</span>, <span class="st">&#39;Jon&#39;</span>),</span>
<span id="cb120-3"><a href="everyday-data-wrangling.html#cb120-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">city =</span> <span class="fu">c</span>(<span class="st">&#39;Tokyo&#39;</span>, <span class="st">&#39;London&#39;</span>, <span class="st">&#39;Milan&#39;</span>),</span>
<span id="cb120-4"><a href="everyday-data-wrangling.html#cb120-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">c</span>(<span class="dv">28</span>, <span class="dv">25</span>, <span class="dv">21</span>)</span>
<span id="cb120-5"><a href="everyday-data-wrangling.html#cb120-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb120-6"><a href="everyday-data-wrangling.html#cb120-6" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb120-7"><a href="everyday-data-wrangling.html#cb120-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">&#39;Brian&#39;</span>, <span class="st">&#39;Connor&#39;</span>),</span>
<span id="cb120-8"><a href="everyday-data-wrangling.html#cb120-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">hair =</span> <span class="fu">c</span>(<span class="st">&#39;black&#39;</span>, <span class="st">&#39;brown&#39;</span>),</span>
<span id="cb120-9"><a href="everyday-data-wrangling.html#cb120-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">eyes =</span> <span class="fu">c</span>(<span class="st">&#39;dark&#39;</span>, <span class="st">&#39;hazel&#39;</span>)</span>
<span id="cb120-10"><a href="everyday-data-wrangling.html#cb120-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="everyday-data-wrangling.html#cb121-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(df2, <span class="at">by =</span> <span class="st">&#39;name&#39;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 5
##   name   city     age hair  eyes 
##   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
## 1 Brian  Tokyo     28 black dark 
## 2 Connor London    25 brown hazel</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="everyday-data-wrangling.html#cb123-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(df2, <span class="at">by =</span> <span class="st">&#39;name&#39;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 5
##   name   city     age hair  eyes 
##   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
## 1 Brian  Tokyo     28 black dark 
## 2 Connor London    25 brown hazel
## 3 Jon    Milan     21 &lt;NA&gt;  &lt;NA&gt;</code></pre>
<p>Base R uses <code>merge()</code> with the argument <code>all.x =</code> and <code>all_y =</code>:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="everyday-data-wrangling.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(df1, df2, <span class="at">by =</span> <span class="st">&#39;name&#39;</span>)</span></code></pre></div>
<pre><code>##     name   city age  hair  eyes
## 1  Brian  Tokyo  28 black  dark
## 2 Connor London  25 brown hazel</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="everyday-data-wrangling.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(df1, df2, <span class="at">by =</span> <span class="st">&#39;name&#39;</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##     name   city age  hair  eyes
## 1  Brian  Tokyo  28 black  dark
## 2 Connor London  25 brown hazel
## 3    Jon  Milan  21  &lt;NA&gt;  &lt;NA&gt;</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="everyday-iterations.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/01-DataWrangling.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
