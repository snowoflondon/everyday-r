<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Interlude I: A brief glimpse into data.table | Everyday-R: Practical R for Data Science</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Interlude I: A brief glimpse into data.table | Everyday-R: Practical R for Data Science" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Interlude I: A brief glimpse into data.table | Everyday-R: Practical R for Data Science" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="by Brian Jungmin Park" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="everyday-iterations.html"/>
<link rel="next" href="everyday-exploratory-data-analysis.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Everyday-R by snowoflondon</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#preface"><i class="fa fa-check"></i><b>1.1</b> Preface</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#r-syntax-in-this-book"><i class="fa fa-check"></i><b>1.2</b> R syntax in this book</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#r-packages-commonly-used-in-this-book"><i class="fa fa-check"></i><b>1.3</b> R packages commonly used in this book</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#installing-r-packages"><i class="fa fa-check"></i><b>1.4</b> Installing R packages</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#code-availability"><i class="fa fa-check"></i><b>1.5</b> Code availability</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#website-hosting"><i class="fa fa-check"></i><b>1.6</b> Website hosting</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html"><i class="fa fa-check"></i><b>2</b> Everyday data wrangling</a>
<ul>
<li class="chapter" data-level="2.1" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#renaming-column-headers"><i class="fa fa-check"></i><b>2.1</b> Renaming column headers</a></li>
<li class="chapter" data-level="2.2" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#grouped-operations"><i class="fa fa-check"></i><b>2.2</b> Grouped operations</a></li>
<li class="chapter" data-level="2.3" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#data-transformation"><i class="fa fa-check"></i><b>2.3</b> Data transformation</a></li>
<li class="chapter" data-level="2.4" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#joining-and-separating-character-columns"><i class="fa fa-check"></i><b>2.4</b> Joining and separating character columns</a></li>
<li class="chapter" data-level="2.5" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#filtering-rows"><i class="fa fa-check"></i><b>2.5</b> Filtering rows</a></li>
<li class="chapter" data-level="2.6" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#subsetting-columns-based-on-strings"><i class="fa fa-check"></i><b>2.6</b> Subsetting columns based on strings</a></li>
<li class="chapter" data-level="2.7" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#long-and-wide-data-formats"><i class="fa fa-check"></i><b>2.7</b> Long and wide data formats</a></li>
<li class="chapter" data-level="2.8" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#trimming-strings"><i class="fa fa-check"></i><b>2.8</b> Trimming strings</a></li>
<li class="chapter" data-level="2.9" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#iterating-over-list-of-dataframes"><i class="fa fa-check"></i><b>2.9</b> Iterating over list of dataframes</a></li>
<li class="chapter" data-level="2.10" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#rowwise-operations"><i class="fa fa-check"></i><b>2.10</b> Rowwise operations</a></li>
<li class="chapter" data-level="2.11" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#conditional-transformation"><i class="fa fa-check"></i><b>2.11</b> Conditional transformation</a></li>
<li class="chapter" data-level="2.12" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#missing-values"><i class="fa fa-check"></i><b>2.12</b> Missing values</a></li>
<li class="chapter" data-level="2.13" data-path="everyday-data-wrangling.html"><a href="everyday-data-wrangling.html#joining-dataframes"><i class="fa fa-check"></i><b>2.13</b> Joining dataframes</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="everyday-iterations.html"><a href="everyday-iterations.html"><i class="fa fa-check"></i><b>3</b> Everyday iterations</a>
<ul>
<li class="chapter" data-level="3.1" data-path="everyday-iterations.html"><a href="everyday-iterations.html#iterating-over-multiple-columns-using-apply-dplyr-and-purrr"><i class="fa fa-check"></i><b>3.1</b> Iterating over multiple columns using <code>apply()</code>, <code>dplyr</code>, and <code>purrr</code></a></li>
<li class="chapter" data-level="3.2" data-path="everyday-iterations.html"><a href="everyday-iterations.html#iterating-over-lists"><i class="fa fa-check"></i><b>3.2</b> Iterating over lists</a></li>
<li class="chapter" data-level="3.3" data-path="everyday-iterations.html"><a href="everyday-iterations.html#iterating-over-vectors"><i class="fa fa-check"></i><b>3.3</b> Iterating over vectors</a></li>
<li class="chapter" data-level="3.4" data-path="everyday-iterations.html"><a href="everyday-iterations.html#iterating-with-two-inputs"><i class="fa fa-check"></i><b>3.4</b> Iterating with two inputs</a></li>
<li class="chapter" data-level="3.5" data-path="everyday-iterations.html"><a href="everyday-iterations.html#iterating-over-indices-and-names"><i class="fa fa-check"></i><b>3.5</b> Iterating over indices and names</a></li>
<li class="chapter" data-level="3.6" data-path="everyday-iterations.html"><a href="everyday-iterations.html#handling-errors-within-purrr"><i class="fa fa-check"></i><b>3.6</b> Handling errors within <code>purrr</code></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="interlude-i-a-brief-glimpse-into-data.html"><a href="interlude-i-a-brief-glimpse-into-data.html"><i class="fa fa-check"></i><b>4</b> Interlude I: A brief glimpse into <code>data.table</code></a>
<ul>
<li class="chapter" data-level="4.1" data-path="interlude-i-a-brief-glimpse-into-data.html"><a href="interlude-i-a-brief-glimpse-into-data.html#data-wrangling-operations"><i class="fa fa-check"></i><b>4.1</b> Data wrangling operations</a></li>
<li class="chapter" data-level="4.2" data-path="interlude-i-a-brief-glimpse-into-data.html"><a href="interlude-i-a-brief-glimpse-into-data.html#sd-.sdcols-and"><i class="fa fa-check"></i><b>4.2</b> <code>.SD</code>, <code>.SDcols</code>, and <code>:=</code></a></li>
<li class="chapter" data-level="4.3" data-path="interlude-i-a-brief-glimpse-into-data.html"><a href="interlude-i-a-brief-glimpse-into-data.html#reshaping-data-using-melt-and-dcast"><i class="fa fa-check"></i><b>4.3</b> Reshaping data using <code>melt</code> and <code>dcast</code></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="everyday-exploratory-data-analysis.html"><a href="everyday-exploratory-data-analysis.html"><i class="fa fa-check"></i><b>5</b> Everyday exploratory data analysis</a>
<ul>
<li class="chapter" data-level="5.1" data-path="everyday-exploratory-data-analysis.html"><a href="everyday-exploratory-data-analysis.html#workflow-1-continuous-data"><i class="fa fa-check"></i><b>5.1</b> Workflow 1: continuous data</a></li>
<li class="chapter" data-level="5.2" data-path="everyday-exploratory-data-analysis.html"><a href="everyday-exploratory-data-analysis.html#workflow-2-dates-and-ordinal-data"><i class="fa fa-check"></i><b>5.2</b> Workflow 2: dates and ordinal data</a></li>
<li class="chapter" data-level="5.3" data-path="everyday-exploratory-data-analysis.html"><a href="everyday-exploratory-data-analysis.html#visualization-of-clusters"><i class="fa fa-check"></i><b>5.3</b> Visualization of clusters</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="everyday-ml-classification.html"><a href="everyday-ml-classification.html"><i class="fa fa-check"></i><b>6</b> Everyday ML: Classification</a>
<ul>
<li class="chapter" data-level="6.1" data-path="everyday-ml-classification.html"><a href="everyday-ml-classification.html#model-training-and-predictions"><i class="fa fa-check"></i><b>6.1</b> Model training and predictions</a></li>
<li class="chapter" data-level="6.2" data-path="everyday-ml-classification.html"><a href="everyday-ml-classification.html#feature-selection-using-univariate-filters"><i class="fa fa-check"></i><b>6.2</b> Feature selection using univariate filters</a></li>
<li class="chapter" data-level="6.3" data-path="everyday-ml-classification.html"><a href="everyday-ml-classification.html#feature-selection-using-recursive-feature-elimination"><i class="fa fa-check"></i><b>6.3</b> Feature selection using recursive feature elimination</a></li>
<li class="chapter" data-level="6.4" data-path="everyday-ml-classification.html"><a href="everyday-ml-classification.html#feature-selection-for-correlated-and-low-variance-predictors"><i class="fa fa-check"></i><b>6.4</b> Feature selection for correlated and low-variance predictors</a></li>
<li class="chapter" data-level="6.5" data-path="everyday-ml-classification.html"><a href="everyday-ml-classification.html#hyperparameter-tuning"><i class="fa fa-check"></i><b>6.5</b> Hyperparameter tuning</a></li>
<li class="chapter" data-level="6.6" data-path="everyday-ml-classification.html"><a href="everyday-ml-classification.html#roc-and-precision-recall-curves"><i class="fa fa-check"></i><b>6.6</b> ROC and precision-recall curves</a></li>
<li class="chapter" data-level="6.7" data-path="everyday-ml-classification.html"><a href="everyday-ml-classification.html#model-comparisons"><i class="fa fa-check"></i><b>6.7</b> Model comparisons</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Everyday-R: Practical R for Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="interlude-i-a-brief-glimpse-into-data.table" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Interlude I: A brief glimpse into <code>data.table</code><a href="interlude-i-a-brief-glimpse-into-data.html#interlude-i-a-brief-glimpse-into-data.table" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In the first chapter, we saw various practical solutions in data wrangling using <code>tidyverse</code> and base R. One topic that has not been discussed is the idea of computational efficiency and runtime - this matter has been trivial so far since the datasets have been considerably tiny. However, when working with large data, it may be in the user’s interest to try using an alternative package designed for reducing programming and computation time - <code>data.table</code>. The vignette is available <a href="https://rdatatable.gitlab.io/data.table/articles/datatable-intro.html">here</a>.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb220-1" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb220-2"><a href="interlude-i-a-brief-glimpse-into-data.html#cb220-2" tabindex="-1"></a><span class="fu">options</span>(<span class="at">datatable.print.nrows=</span><span class="dv">10</span>)</span></code></pre></div>
<p>Similarly to how a <code>tibble</code> is an enhanced form of a <code>data.frame</code> in <code>tidyverse</code>, <code>data.table</code> uses an object class called a <code>data.table</code>. Using <code>fread()</code> to read in data - whether the argument corresponds to a local file or a URL pointing to a dataset - automatically generates a <code>data.table</code> object. Converting a regular <code>data.frame</code> to a <code>data.table</code> is done with <code>setDT()</code>.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb221-1" tabindex="-1"></a><span class="fu">data</span>(mtcars)</span>
<span id="cb221-2"><a href="interlude-i-a-brief-glimpse-into-data.html#cb221-2" tabindex="-1"></a><span class="fu">setDT</span>(mtcars)</span>
<span id="cb221-3"><a href="interlude-i-a-brief-glimpse-into-data.html#cb221-3" tabindex="-1"></a><span class="fu">head</span>(mtcars, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##      mpg cyl  disp  hp drat    wt  qsec vs am gear carb
##  1: 21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
##  2: 21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
##  3: 22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
##  4: 21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
##  5: 18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
##  6: 18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
##  7: 14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
##  8: 24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
##  9: 22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
## 10: 19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4</code></pre>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb223-1" tabindex="-1"></a><span class="fu">class</span>(mtcars)[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] &quot;data.table&quot;</code></pre>
<div id="data-wrangling-operations" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Data wrangling operations<a href="interlude-i-a-brief-glimpse-into-data.html#data-wrangling-operations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The vignette does a great job explaining the syntax of <code>data.table</code> in detail, but the takeaway message is that it subsets the data by <code>i</code>, performs an operation according to <code>j</code>, then groups it using <code>by =</code>. That is, <code>DT[i, j, by]</code>.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb225-1" tabindex="-1"></a>mtcars[cyl <span class="sc">==</span> <span class="dv">6</span>, .(<span class="at">mean_mileage =</span> <span class="fu">mean</span>(mpg))]</span></code></pre></div>
<pre><code>##    mean_mileage
## 1:     19.74286</code></pre>
<p>Above, <code>data.table</code> has subsetted the object based on <code>cyl == 6</code> then calculated the mean mileage. The <code>j</code> is wrapped around <code>.()</code>, which is equivalent to <code>list()</code> - this is because the columns in a table are analogous to a <code>list</code> object and we want to return a <code>data.table</code> as our output rather than an atomic vector.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb227-1" tabindex="-1"></a><span class="fu">class</span>(mtcars[cyl <span class="sc">==</span> <span class="dv">6</span>, .(<span class="at">mean_mileage =</span> <span class="fu">mean</span>(mpg))])</span></code></pre></div>
<pre><code>## [1] &quot;data.table&quot; &quot;data.frame&quot;</code></pre>
<p>Multiple calculations can be performed in <code>j</code>:</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb229-1" tabindex="-1"></a>mtcars[cyl <span class="sc">==</span> <span class="dv">6</span> <span class="sc">&amp;</span> gear <span class="sc">==</span> <span class="dv">4</span>, .(<span class="at">mean_mileage =</span> <span class="fu">mean</span>(mpg), <span class="at">median_wt =</span> <span class="fu">median</span>(wt))]</span></code></pre></div>
<pre><code>##    mean_mileage median_wt
## 1:        19.75    3.1575</code></pre>
<p>Calculating the number of rows in <code>j</code> uses a special variable <code>.N</code>.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb231-1" tabindex="-1"></a>mtcars[cyl <span class="sc">==</span> <span class="dv">6</span> <span class="sc">&amp;</span> gear <span class="sc">==</span> <span class="dv">4</span>, .N]</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p>The <code>j</code> argument can be used to select columns after subsetting rows with <code>i</code>; this is analogous to <code>filter()</code> and <code>select()</code> in <code>dplyr</code>:</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb233-1" tabindex="-1"></a>mtcars[, .(mpg, wt, gear)][<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>##      mpg    wt gear
##  1: 21.0 2.620    4
##  2: 21.0 2.875    4
##  3: 22.8 2.320    4
##  4: 21.4 3.215    3
##  5: 18.7 3.440    3
##  6: 18.1 3.460    3
##  7: 14.3 3.570    3
##  8: 24.4 3.190    4
##  9: 22.8 3.150    4
## 10: 19.2 3.440    4</code></pre>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb235-1" tabindex="-1"></a>my_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;mpg&#39;</span>, <span class="st">&#39;wt&#39;</span>, <span class="st">&#39;gear&#39;</span>)</span>
<span id="cb235-2"><a href="interlude-i-a-brief-glimpse-into-data.html#cb235-2" tabindex="-1"></a>mtcars[, ..my_cols][<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>##      mpg    wt gear
##  1: 21.0 2.620    4
##  2: 21.0 2.875    4
##  3: 22.8 2.320    4
##  4: 21.4 3.215    3
##  5: 18.7 3.440    3
##  6: 18.1 3.460    3
##  7: 14.3 3.570    3
##  8: 24.4 3.190    4
##  9: 22.8 3.150    4
## 10: 19.2 3.440    4</code></pre>
<p>Using <code>by =</code> argument is similar to <code>group_by()</code> in <code>dplyr</code>:</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb237-1" tabindex="-1"></a>mtcars[, .(<span class="at">mean_mileage =</span> <span class="fu">mean</span>(mpg), <span class="at">median_wt =</span> <span class="fu">median</span>(wt)), by <span class="ot">=</span> cyl]</span></code></pre></div>
<pre><code>##    cyl mean_mileage median_wt
## 1:   6     19.74286     3.215
## 2:   4     26.66364     2.200
## 3:   8     15.10000     3.755</code></pre>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb239-1" tabindex="-1"></a>mtcars[, .N, by <span class="ot">=</span> cyl]</span></code></pre></div>
<pre><code>##    cyl  N
## 1:   6  7
## 2:   4 11
## 3:   8 14</code></pre>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb241-1" tabindex="-1"></a>mtcars[vs <span class="sc">==</span> <span class="dv">0</span>, .N, by <span class="ot">=</span> .(cyl, gear)]</span></code></pre></div>
<pre><code>##    cyl gear  N
## 1:   6    4  2
## 2:   8    3 12
## 3:   4    5  1
## 4:   8    5  2
## 5:   6    5  1</code></pre>
<p>Piping multiple operations together in <code>data.table</code> is straightforward:</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb243-1" tabindex="-1"></a>mtcars[vs <span class="sc">==</span> <span class="dv">0</span>, .(mpg, cyl, gear)][,.(<span class="at">mean_mpg =</span> <span class="fu">mean</span>(mpg)), by <span class="ot">=</span> .(cyl, gear)]</span></code></pre></div>
<pre><code>##    cyl gear mean_mpg
## 1:   6    4    21.00
## 2:   8    3    15.05
## 3:   4    5    26.00
## 4:   8    5    15.40
## 5:   6    5    19.70</code></pre>
</div>
<div id="sd-.sdcols-and" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> <code>.SD</code>, <code>.SDcols</code>, and <code>:=</code><a href="interlude-i-a-brief-glimpse-into-data.html#sd-.sdcols-and" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For slightly more difficult operations, we need to define three new concepts: firstly, the <code>.SD</code> variable points to the current <em>subset of data</em>.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb245-1" tabindex="-1"></a>mtcars[cyl <span class="sc">==</span> <span class="dv">6</span>, .SD]</span></code></pre></div>
<pre><code>##     mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## 1: 21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## 2: 21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## 3: 21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
## 4: 18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
## 5: 19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
## 6: 17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
## 7: 19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6</code></pre>
<p>In above context, the <code>.SD</code> doesn’t do much. but this special variable is useful when you’re doing operations over multiple columns. Using <code>.SDcols</code> with <code>.SD</code> allows user to specifically <em>point to columns across the current subset of data</em>.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb247-1" tabindex="-1"></a>mtcars[cyl <span class="sc">==</span> <span class="dv">6</span>, .SD, .SDcols <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;disp&#39;</span>, <span class="st">&#39;hp&#39;</span>, <span class="st">&#39;drat&#39;</span>)]</span></code></pre></div>
<pre><code>##     disp  hp drat
## 1: 160.0 110 3.90
## 2: 160.0 110 3.90
## 3: 258.0 110 3.08
## 4: 225.0 105 2.76
## 5: 167.6 123 3.92
## 6: 167.6 123 3.92
## 7: 145.0 175 3.62</code></pre>
<p>This means we can easily perform operations across a subset of columns:</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb249-1" tabindex="-1"></a>mtcars[, <span class="fu">lapply</span>(.SD, mean), by <span class="ot">=</span> cyl, .SDcols <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;disp&#39;</span>, <span class="st">&#39;hp&#39;</span>, <span class="st">&#39;drat&#39;</span>)]</span></code></pre></div>
<pre><code>##    cyl     disp        hp     drat
## 1:   6 183.3143 122.28571 3.585714
## 2:   4 105.1364  82.63636 4.070909
## 3:   8 353.1000 209.21429 3.229286</code></pre>
<p><code>.SDcols</code> is flexible because it also accepts indices:</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb251-1" tabindex="-1"></a>col_idx <span class="ot">&lt;-</span> <span class="fu">colnames</span>(mtcars) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;disp&#39;</span>, <span class="st">&#39;hp&#39;</span>, <span class="st">&#39;drat&#39;</span>)</span>
<span id="cb251-2"><a href="interlude-i-a-brief-glimpse-into-data.html#cb251-2" tabindex="-1"></a>mtcars[, <span class="fu">lapply</span>(.SD, mean), by <span class="ot">=</span> cyl, .SDcols <span class="ot">=</span> col_idx]</span></code></pre></div>
<pre><code>##    cyl     disp        hp     drat
## 1:   6 183.3143 122.28571 3.585714
## 2:   4 105.1364  82.63636 4.070909
## 3:   8 353.1000 209.21429 3.229286</code></pre>
<p>Using the <code>:=</code> operator allows user to define new columns in one of two ways: firstly, in a simple <code>LHS := RHS</code> syntax; this creates a new column but does not print the result to the console.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb253-1" tabindex="-1"></a>mtcars[, HpPerMpg <span class="sc">:=</span> .(hp<span class="sc">/</span>mpg)]</span>
<span id="cb253-2"><a href="interlude-i-a-brief-glimpse-into-data.html#cb253-2" tabindex="-1"></a><span class="fu">head</span>(mtcars)</span></code></pre></div>
<pre><code>##     mpg cyl disp  hp drat    wt  qsec vs am gear carb HpPerMpg
## 1: 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4 5.238095
## 2: 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4 5.238095
## 3: 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1 4.078947
## 4: 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1 5.140187
## 5: 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2 9.358289
## 6: 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1 5.801105</code></pre>
<p>This allows users to remove columns by setting the RHS to <code>NULL</code>:</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb255-1" tabindex="-1"></a><span class="co"># not run</span></span>
<span id="cb255-2"><a href="interlude-i-a-brief-glimpse-into-data.html#cb255-2" tabindex="-1"></a>mtcars[, HpPerMpg <span class="sc">:=</span> <span class="cn">NULL</span>]</span></code></pre></div>
<p>Subsetting using <code>i</code> allows for condition-based operations, similar to <code>mutate(case_when())</code> in <code>dplyr</code>:</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb256-1" tabindex="-1"></a>mtcars[cyl <span class="sc">==</span> <span class="dv">6</span>, CylThreshold <span class="sc">:=</span> <span class="st">&#39;Over 6&#39;</span>][cyl <span class="sc">!=</span> <span class="dv">6</span>, CylThreshold <span class="sc">:=</span> <span class="st">&#39;Under 6&#39;</span>]</span>
<span id="cb256-2"><a href="interlude-i-a-brief-glimpse-into-data.html#cb256-2" tabindex="-1"></a><span class="fu">head</span>(mtcars)</span></code></pre></div>
<pre><code>##     mpg cyl disp  hp drat    wt  qsec vs am gear carb HpPerMpg
## 1: 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4 5.238095
## 2: 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4 5.238095
## 3: 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1 4.078947
## 4: 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1 5.140187
## 5: 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2 9.358289
## 6: 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1 5.801105
##    CylThreshold
## 1:       Over 6
## 2:       Over 6
## 3:      Under 6
## 4:       Over 6
## 5:      Under 6
## 6:       Over 6</code></pre>
<p>Secondly, <code>:=</code> can be used in a functional form:</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb258-1" tabindex="-1"></a>mtcars[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">HpPerMpg =</span> hp<span class="sc">/</span>mpg, <span class="at">MpgXCyl =</span> mpg<span class="sc">*</span>cyl)]</span>
<span id="cb258-2"><a href="interlude-i-a-brief-glimpse-into-data.html#cb258-2" tabindex="-1"></a><span class="fu">head</span>(mtcars)</span></code></pre></div>
<pre><code>##     mpg cyl disp  hp drat    wt  qsec vs am gear carb HpPerMpg
## 1: 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4 5.238095
## 2: 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4 5.238095
## 3: 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1 4.078947
## 4: 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1 5.140187
## 5: 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2 9.358289
## 6: 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1 5.801105
##    CylThreshold MpgXCyl
## 1:       Over 6   126.0
## 2:       Over 6   126.0
## 3:      Under 6    91.2
## 4:       Over 6   128.4
## 5:      Under 6   149.6
## 6:       Over 6   108.6</code></pre>
<p>Combining the <code>:=</code> with <code>by =</code>:</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb260-1" tabindex="-1"></a>mtcars[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">mean_mileage =</span> <span class="fu">mean</span>(mpg)), by <span class="ot">=</span> .(cyl, vs)]</span>
<span id="cb260-2"><a href="interlude-i-a-brief-glimpse-into-data.html#cb260-2" tabindex="-1"></a><span class="fu">head</span>(mtcars)</span></code></pre></div>
<pre><code>##     mpg cyl disp  hp drat    wt  qsec vs am gear carb HpPerMpg
## 1: 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4 5.238095
## 2: 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4 5.238095
## 3: 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1 4.078947
## 4: 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1 5.140187
## 5: 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2 9.358289
## 6: 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1 5.801105
##    CylThreshold MpgXCyl mean_mileage
## 1:       Over 6   126.0     20.56667
## 2:       Over 6   126.0     20.56667
## 3:      Under 6    91.2     26.73000
## 4:       Over 6   128.4     19.12500
## 5:      Under 6   149.6     15.10000
## 6:       Over 6   108.6     19.12500</code></pre>
<p>Combining <code>.SD</code> with the <code>:=</code> operator:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb262-1" tabindex="-1"></a>mtcars[, <span class="fu">c</span>(<span class="st">&#39;max_disp&#39;</span>, <span class="st">&#39;max_hp&#39;</span>, <span class="st">&#39;max_wt&#39;</span>) <span class="sc">:=</span> <span class="fu">lapply</span>(.SD, max), </span>
<span id="cb262-2"><a href="interlude-i-a-brief-glimpse-into-data.html#cb262-2" tabindex="-1"></a>       by <span class="ot">=</span> cyl, .SDcols <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;disp&#39;</span>, <span class="st">&#39;hp&#39;</span>, <span class="st">&#39;wt&#39;</span>)]</span>
<span id="cb262-3"><a href="interlude-i-a-brief-glimpse-into-data.html#cb262-3" tabindex="-1"></a><span class="fu">head</span>(mtcars)</span></code></pre></div>
<pre><code>##     mpg cyl disp  hp drat    wt  qsec vs am gear carb HpPerMpg
## 1: 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4 5.238095
## 2: 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4 5.238095
## 3: 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1 4.078947
## 4: 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1 5.140187
## 5: 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2 9.358289
## 6: 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1 5.801105
##    CylThreshold MpgXCyl mean_mileage max_disp max_hp max_wt
## 1:       Over 6   126.0     20.56667    258.0    175  3.460
## 2:       Over 6   126.0     20.56667    258.0    175  3.460
## 3:      Under 6    91.2     26.73000    146.7    113  3.190
## 4:       Over 6   128.4     19.12500    258.0    175  3.460
## 5:      Under 6   149.6     15.10000    472.0    335  5.424
## 6:       Over 6   108.6     19.12500    258.0    175  3.460</code></pre>
<p>Finally, a strange behaviour is observed when we start making copies of data; for example:</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb264-1" tabindex="-1"></a><span class="fu">data</span>(iris)</span>
<span id="cb264-2"><a href="interlude-i-a-brief-glimpse-into-data.html#cb264-2" tabindex="-1"></a><span class="fu">setDT</span>(iris)</span></code></pre></div>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb265-1" tabindex="-1"></a>iris2 <span class="ot">&lt;-</span> iris</span>
<span id="cb265-2"><a href="interlude-i-a-brief-glimpse-into-data.html#cb265-2" tabindex="-1"></a><span class="fu">identical</span>(iris, iris2)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Now see what happens when we change one of the columns in <code>iris2</code> using <code>:=</code>:</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb267-1" tabindex="-1"></a>iris2[, Petal.Width <span class="sc">:=</span> Petal.Width<span class="sc">/</span><span class="dv">100</span>]</span>
<span id="cb267-2"><a href="interlude-i-a-brief-glimpse-into-data.html#cb267-2" tabindex="-1"></a>iris2</span></code></pre></div>
<pre><code>##      Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
##   1:          5.1         3.5          1.4       0.002    setosa
##   2:          4.9         3.0          1.4       0.002    setosa
##   3:          4.7         3.2          1.3       0.002    setosa
##   4:          4.6         3.1          1.5       0.002    setosa
##   5:          5.0         3.6          1.4       0.002    setosa
##  ---                                                            
## 146:          6.7         3.0          5.2       0.023 virginica
## 147:          6.3         2.5          5.0       0.019 virginica
## 148:          6.5         3.0          5.2       0.020 virginica
## 149:          6.2         3.4          5.4       0.023 virginica
## 150:          5.9         3.0          5.1       0.018 virginica</code></pre>
<p>It turns out that changing <code>iris2</code> has also changed the original data <code>iris</code>:</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb269-1" tabindex="-1"></a><span class="fu">head</span>(iris)</span></code></pre></div>
<pre><code>##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1:          5.1         3.5          1.4       0.002  setosa
## 2:          4.9         3.0          1.4       0.002  setosa
## 3:          4.7         3.2          1.3       0.002  setosa
## 4:          4.6         3.1          1.5       0.002  setosa
## 5:          5.0         3.6          1.4       0.002  setosa
## 6:          5.4         3.9          1.7       0.004  setosa</code></pre>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb271-1" tabindex="-1"></a><span class="fu">identical</span>(iris, iris2)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>However, if we use <code>&lt;-</code> to change one of the columns of <code>iris2</code>, the original <code>iris</code> data does not change:</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb273-1" tabindex="-1"></a>iris2<span class="sc">$</span>Petal.Length <span class="ot">&lt;-</span> iris2<span class="sc">$</span>Petal.Length<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb273-2"><a href="interlude-i-a-brief-glimpse-into-data.html#cb273-2" tabindex="-1"></a><span class="fu">identical</span>(iris, iris2)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>The rationale for this behaviour is well-explained in this stackoverflow <a href="https://stackoverflow.com/questions/10225098/understanding-exactly-when-a-data-table-is-a-reference-to-vs-a-copy-of-another">post</a>, but essentially what happens is that <code>:=</code> operator <em>modifies by reference</em>. Both <code>iris2</code> and <code>iris</code> are pointing to the same location after copying initially with <code>&lt;-</code>. Thus when we modify the copy of <code>iris</code> by reference, there is no need to copy the entire dataset <code>iris</code> to alter its copy. On the other hand, changing <code>iris2</code> using <code>&lt;-</code> will copy the entire thing even if we’re only changing just one column. This behaviour is undesirable when we’re working with very large data.</p>
<p>To avoid changing the original dataset but still use <code>:=</code> to update a copy, <code>data.table</code> uses the <code>copy()</code> function:</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb275-1" tabindex="-1"></a>iris3 <span class="ot">&lt;-</span> <span class="fu">copy</span>(iris)</span>
<span id="cb275-2"><a href="interlude-i-a-brief-glimpse-into-data.html#cb275-2" tabindex="-1"></a>iris3[, Petal.Width <span class="sc">:=</span> Petal.Width<span class="sc">/</span><span class="dv">100</span>]</span>
<span id="cb275-3"><a href="interlude-i-a-brief-glimpse-into-data.html#cb275-3" tabindex="-1"></a><span class="fu">identical</span>(iris, iris3) <span class="co"># only the iris3 object was changed here</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
</div>
<div id="reshaping-data-using-melt-and-dcast" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Reshaping data using <code>melt</code> and <code>dcast</code><a href="interlude-i-a-brief-glimpse-into-data.html#reshaping-data-using-melt-and-dcast" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the first chapter, I briefly touched on <code>melt()</code> as an alternative to <code>tidr::pivot_longer()</code>. Base R’s equivalent <code>reshape()</code> is rather clunky to use, so I much prefer the <code>tidyr</code> or <code>data.table</code> solutions.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb277-1" tabindex="-1"></a>DT <span class="ot">&lt;-</span> <span class="fu">data.table</span>(</span>
<span id="cb277-2"><a href="interlude-i-a-brief-glimpse-into-data.html#cb277-2" tabindex="-1"></a>  <span class="at">Team =</span> <span class="fu">c</span>(<span class="st">&#39;Tottenham&#39;</span>, <span class="st">&#39;Arsenal&#39;</span>, <span class="st">&#39;Chelsea&#39;</span>, <span class="st">&#39;ManUnited&#39;</span>),</span>
<span id="cb277-3"><a href="interlude-i-a-brief-glimpse-into-data.html#cb277-3" tabindex="-1"></a>  <span class="at">Wins =</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">6</span>),</span>
<span id="cb277-4"><a href="interlude-i-a-brief-glimpse-into-data.html#cb277-4" tabindex="-1"></a>  <span class="at">Goals =</span> <span class="fu">c</span>(<span class="dv">29</span>, <span class="dv">18</span>, <span class="dv">22</span>, <span class="dv">26</span>),</span>
<span id="cb277-5"><a href="interlude-i-a-brief-glimpse-into-data.html#cb277-5" tabindex="-1"></a>  <span class="at">CleanSheets =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb277-6"><a href="interlude-i-a-brief-glimpse-into-data.html#cb277-6" tabindex="-1"></a>)</span>
<span id="cb277-7"><a href="interlude-i-a-brief-glimpse-into-data.html#cb277-7" tabindex="-1"></a>DT</span></code></pre></div>
<pre><code>##         Team Wins Goals CleanSheets
## 1: Tottenham    7    29           3
## 2:   Arsenal    3    18           1
## 3:   Chelsea    4    22           2
## 4: ManUnited    6    26           3</code></pre>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb279-1" tabindex="-1"></a>DT_long <span class="ot">&lt;-</span> <span class="fu">melt</span>(DT, <span class="at">id.vars =</span> <span class="st">&#39;Team&#39;</span>, <span class="at">measure.vars =</span> <span class="fu">c</span>(<span class="st">&#39;Wins&#39;</span>, <span class="st">&#39;Goals&#39;</span>, <span class="st">&#39;CleanSheets&#39;</span>),</span>
<span id="cb279-2"><a href="interlude-i-a-brief-glimpse-into-data.html#cb279-2" tabindex="-1"></a>                <span class="at">variable.name =</span> <span class="st">&#39;Stat&#39;</span>, <span class="at">value.name =</span> <span class="st">&#39;Value&#39;</span>)</span>
<span id="cb279-3"><a href="interlude-i-a-brief-glimpse-into-data.html#cb279-3" tabindex="-1"></a>DT_long</span></code></pre></div>
<pre><code>##          Team        Stat Value
##  1: Tottenham        Wins     7
##  2:   Arsenal        Wins     3
##  3:   Chelsea        Wins     4
##  4: ManUnited        Wins     6
##  5: Tottenham       Goals    29
## ---                            
##  8: ManUnited       Goals    26
##  9: Tottenham CleanSheets     3
## 10:   Arsenal CleanSheets     1
## 11:   Chelsea CleanSheets     2
## 12: ManUnited CleanSheets     3</code></pre>
<p>The <code>data.table</code> equivalent to <code>tidyr::pivot_wider()</code> is <code>dcast()</code>; this function takes in a formula as an argument (<code>~</code>) where the LHS corresponds to the <code>id.vars</code> and the RHS corresponds to the column that originated from the <code>measure.vars</code>. Running this yields the original dataset:</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="interlude-i-a-brief-glimpse-into-data.html#cb281-1" tabindex="-1"></a><span class="fu">dcast</span>(DT_long, Team <span class="sc">~</span> Stat, <span class="at">value.var =</span> <span class="st">&#39;Value&#39;</span>)</span></code></pre></div>
<pre><code>##         Team Wins Goals CleanSheets
## 1:   Arsenal    3    18           1
## 2:   Chelsea    4    22           2
## 3: ManUnited    6    26           3
## 4: Tottenham    7    29           3</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="everyday-iterations.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="everyday-exploratory-data-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/03-DataTable.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
